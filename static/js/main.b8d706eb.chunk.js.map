{"version":3,"sources":["element/newElement.ts","math.ts","element/bounds.ts","element/handlerRectangles.ts","element/collision.ts","element/resizeTest.ts","element/typeChecks.ts","keys.ts","utils.ts","element/textWysiwyg.tsx","element/textElement.ts","scene/scrollbars.ts","scene/selection.ts","appState.ts","renderer/roundRect.ts","renderer/renderElement.ts","renderer/renderScene.ts","scene/data.ts","scene/comparisons.ts","scene/createScene.ts","shapes.tsx","history.ts","components/Popover.tsx","components/ContextMenu.tsx","actions/manager.tsx","actions/actionDeleteSelected.tsx","zindex.ts","actions/actionZindex.tsx","actions/actionSelectAll.ts","components/ButtonSelect.tsx","components/ColorPicker.tsx","actions/actionProperties.tsx","components/icons.tsx","components/ToolIcon.tsx","actions/actionCanvas.tsx","components/EditableText.tsx","actions/actionExport.tsx","actions/actionStyles.ts","components/Island.tsx","components/Stack.tsx","components/FixedSideContainer.tsx","components/Modal.tsx","components/ExportDialog.tsx","index.tsx"],"names":["newElement","type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","roughness","opacity","width","height","element","id","nanoid","isSelected","seed","randomSeed","shape","duplicateElement","copy","distanceBetweenPointAndSegment","x1","y1","x2","y2","xx","yy","C","D","lenSquare","param","dx","dy","Math","hypot","rotate","angle","cos","sin","getElementAbsoluteCoords","getDiamondPoints","topX","floor","rightX","rightY","getArrowPoints","distance","minSize","min","xs","ys","PI","x3","y3","getLinePoints","handlerRectangles","scrollX","scrollY","elementX1","elementX2","elementY1","elementY2","handlers","marginX","marginY","abs","nw","se","hitTest","px","py","tx","ty","a","b","forEach","ex","ey","rx","ry","qx","qy","r","q","max","t","topY","bottomX","bottomY","leftX","leftY","x4","y4","console","warn","Error","getElementWithResizeHandler","elements","reduce","result","resizeHandle","filter","Object","keys","key","handler","length","resizeTest","isTextElement","KEYS","META_KEY","test","window","navigator","platform","capitalizeString","str","charAt","toUpperCase","slice","isInputLike","target","HTMLElement","dataset","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","measureText","text","font","line","document","createElement","body","style","position","whiteSpace","appendChild","innerText","offsetWidth","offsetHeight","span","display","overflow","baseline","offsetTop","removeChild","selectNode","node","selection","getSelection","range","createRange","selectNodeContents","removeAllRanges","addRange","removeSelection","textWysiwyg","initText","onSubmit","editable","stopEvent","ev","stopPropagation","handleSubmit","cleanup","onblur","onkeydown","onpaste","removeEventListener","contentEditable","tabIndex","assign","color","top","left","transform","textAlign","padding","outline","minHeight","preventDefault","clipboardData","getData","replace","textContent","addEventListener","focus","redrawTextBoundingBox","metrics","getScrollBars","canvasWidth","canvasHeight","minX","Infinity","maxX","minY","maxY","leftOverflow","rightOverflow","topOverflow","bottomOverflow","horizontalScrollBar","SCROLLBAR_MARGIN","verticalScrollBar","SCROLLBAR_WIDTH","horizontal","vertical","clearSelection","newElements","deleteSelectedElements","el","getSelectedIndices","selectedIndices","index","push","getSelectedAttribute","getAttribute","attributes","Array","from","Set","map","DEFAULT_PROJECT_NAME","date","Date","year","getFullYear","month","getMonth","day","getDate","hr","getHours","getMinutes","secs","getSeconds","getDateTime","getDefaultAppState","draggingElement","resizingElement","elementType","exportBackground","currentItemStrokeColor","currentItemBackgroundColor","currentItemFont","viewBackgroundColor","cursorX","cursorY","name","roundRect","context","radius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","stroke","renderElement","rc","generator","fillRect","rectangle","undefined","globalAlpha","draw","polygon","ellipse","curveFitting","options","fillText","actualBoundingBoxAscent","renderScene","canvas","sceneState","offsetX","offsetY","renderScrollbars","renderSelection","getContext","clearRect","translate","selectedElements","lineDash","getLineDash","setLineDash","strokeRect","margin","values","scrollBars","devicePixelRatio","strokeStyle","scrollBar","saveFile","data","link","setAttribute","click","remove","exportCanvas","exportPadding","alert","subCanvasX1","subCanvasX2","subCanvasY1","subCanvasY2","tempCanvas","rough","toDataURL","toBlob","blob","async","clipboard","write","ClipboardItem","err","restore","savedElements","savedState","appState","getElementAtPosition","hitElement","i","SHAPES","icon","viewBox","d","value","strokeLinecap","shapesShortcutKeys","SceneHistory","recording","stateHistory","redoStack","JSON","stringify","newEntry","this","clearRedoStack","entry","parse","splice","entryToRestore","pop","restoreEntry","currentEntry","Popover","children","onCloseRequest","fitInViewport","popoverRef","useRef","useLayoutEffect","current","getBoundingClientRect","viewportWidth","innerWidth","viewportHeight","innerHeight","className","ref","onClick","onContextMenu","e","contextMenuNode","ContextMenu","option","idx","ContextMenuOption","label","action","getContextMenuNode","div","handleClose","unmountComponentAtNode","params","of","render","ActionManager","actions","updater","event","sort","keyPriority","keyTest","perform","actionFilter","contextMenuOrder","contextItemLabel","PanelComponent","updateData","formState","actionDeleteSelected","swap","indexA","indexB","moveOneLeft","indicesToMove","isSorted","moveOneRight","reversedIndicesToMove","moveAllLeft","leftMostElements","reverse","concat","pos","moveAllRight","rightMostElements","actionSendBackward","shiftKey","altKey","code","actionBringForward","actionSendToBack","actionBringToFront","actionSelectAll","elem","ButtonSelect","onChange","Picker","colors","React","useState","innerValue","setInnerValue","useEffect","title","spellCheck","match","clear","ColorPicker","isActive","setActive","Suspense","fallback","changedColor","onPaste","canvasBackground","elementBackground","elementStroke","changeProperty","callback","actionChangeStrokeColor","actionChangeBackgroundColor","actionChangeFillStyle","actionChangeStrokeWidth","actionChangeSloppiness","actionChangeOpacity","actionChangeFontSize","split","actionChangeFontFamily","save","aria-hidden","focusable","role","load","trash","exportFile","downloadFile","ToolIcon","props","aria-label","checked","actionChangeViewBackgroundColor","actionClearCanvas","confirm","EditableText","handleFocus","currentTarget","handleBlur","trim","handleKeyDown","blur","suppressContentEditableWarning","data-type","onBlur","onKeyDown","onFocus","Component","actionChangeProjectName","actionChangeExportBackground","actionSaveScene","serialized","version","source","location","origin","encodeURIComponent","saveAsJSON","actionLoadScene","input","reader","FileReader","accept","onchange","files","readAsText","Promise","resolve","onloadend","readyState","DONE","defaultAppState","loadFromJSON","then","copiedStyles","actionCopyStyles","find","actionPasteStyles","pastedElement","Island","gap","align","alignItems","justifyItems","FixedSideContainer","side","Modal","modalRoot","useBodyRoot","createPortal","maxWidth","probablySupportsClipboard","HTMLCanvasElement","prototype","ExportDialog","actionManager","syncActionResult","onExportToPng","onExportToClipboard","someElementIsSelected","some","modalIsShown","setModalIsShown","exportSelected","setExportSelected","previeRef","exportedElements","previewNode","getExportCanvasPreview","renderAction","history","resetCursor","documentElement","cursor","addTextElement","lastCanvasWidth","lastCanvasHeight","lastMouseUp","viewportCoordsToSceneCoords","clientX","clientY","App","canvasOnlyActions","res","forceUpdate","setState","onCut","setData","onCopy","paste","addElementsFromPaste","state","onResize","getCurrentCursorPosition","activeElement","keyCode","step","includes","toLowerCase","ctrlKey","metaKey","redoOnce","undoOnce","removeWheelEventListener","copyToClipboard","writeText","pasteFromClipboard","readText","handleWheel","deltaX","deltaY","parsedElements","isArray","parsedElement","elementsCenterX","elementsCenterY","duplicate","saveDebounced","fn","timeout","handle","args","clearTimeout","setTimeout","debounce","localStorage","setItem","registerAction","getItem","restoreFromLocalStorage","hasBackground","hasStroke","hasText","renderCanvasActions","renderSelectedShapeActions","renderShapesSwitcher","passive","scale","getContextMenuItems","onMouseDown","button","lastX","lastY","onMouseMove","onMouseUp","isOverHorizontalScrollBar","isOverVerticalScrollBar","isOverScrollBars","isResizingElements","draggingOccured","elementIsAddedToSelection","resizeElement","textX","textY","snappedToCenterPosition","getTextWysiwygSnappedToCenterPosition","elementCenterX","elementCenterY","wysiwygX","wysiwygY","skipRecording","sign","selectionX1","selectionY1","selectionX2","selectionY2","getElementsWithinSelection","resumeRecording","onDoubleClick","elementAtPosition","Boolean","buttons","elementClickedInside","getElementContainingPosition","isRecording","pushEntry","generateCurrentEntry","rootElement","getElementById","ReactDOM"],"mappings":"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","file":"static/js/main.b8d706eb.chunk.js","sourcesContent":["import { randomSeed } from \"roughjs/bin/math\";\nimport nanoid from \"nanoid\";\nimport { Drawable } from \"roughjs/bin/core\";\n\nexport function newElement(\n  type: string,\n  x: number,\n  y: number,\n  strokeColor: string,\n  backgroundColor: string,\n  fillStyle: string,\n  strokeWidth: number,\n  roughness: number,\n  opacity: number,\n  width = 0,\n  height = 0\n) {\n  const element = {\n    id: nanoid(),\n    type,\n    x,\n    y,\n    width,\n    height,\n    strokeColor,\n    backgroundColor,\n    fillStyle,\n    strokeWidth,\n    roughness,\n    opacity,\n    isSelected: false,\n    seed: randomSeed(),\n    shape: null as Drawable | Drawable[] | null\n  };\n  return element;\n}\n\nexport function duplicateElement(element: ReturnType<typeof newElement>) {\n  const copy = { ...element };\n  delete copy.shape;\n  copy.id = nanoid();\n  copy.seed = randomSeed();\n  return copy;\n}\n","// https://stackoverflow.com/a/6853926/232122\nexport function distanceBetweenPointAndSegment(\n  x: number,\n  y: number,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number\n) {\n  const A = x - x1;\n  const B = y - y1;\n  const C = x2 - x1;\n  const D = y2 - y1;\n\n  const dot = A * C + B * D;\n  const lenSquare = C * C + D * D;\n  let param = -1;\n  if (lenSquare !== 0) {\n    // in case of 0 length line\n    param = dot / lenSquare;\n  }\n\n  let xx, yy;\n  if (param < 0) {\n    xx = x1;\n    yy = y1;\n  } else if (param > 1) {\n    xx = x2;\n    yy = y2;\n  } else {\n    xx = x1 + param * C;\n    yy = y1 + param * D;\n  }\n\n  const dx = x - xx;\n  const dy = y - yy;\n  return Math.hypot(dx, dy);\n}\n\nexport function rotate(\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  angle: number\n) {\n  // =()cos()sin+\n  // =()sin+()cos+.\n  // https://math.stackexchange.com/questions/2204520/how-do-i-rotate-a-line-segment-in-a-specific-point-on-the-line\n  return [\n    (x1 - x2) * Math.cos(angle) - (y1 - y2) * Math.sin(angle) + x2,\n    (x1 - x2) * Math.sin(angle) + (y1 - y2) * Math.cos(angle) + y2\n  ];\n}\n","import { ExcalidrawElement } from \"./types\";\nimport { rotate } from \"../math\";\n\n// If the element is created from right to left, the width is going to be negative\n// This set of functions retrieves the absolute position of the 4 points.\n// We can't just always normalize it since we need to remember the fact that an arrow\n// is pointing left or right.\nexport function getElementAbsoluteCoords(element: ExcalidrawElement) {\n  return [\n    element.width >= 0 ? element.x : element.x + element.width, // x1\n    element.height >= 0 ? element.y : element.y + element.height, // y1\n    element.width >= 0 ? element.x + element.width : element.x, // x2\n    element.height >= 0 ? element.y + element.height : element.y // y2\n  ];\n}\n\nexport function getDiamondPoints(element: ExcalidrawElement) {\n  // Here we add +1 to avoid these numbers to be 0\n  // otherwise rough.js will throw an error complaining about it\n  const topX = Math.floor(element.width / 2) + 1;\n  const topY = 0;\n  const rightX = element.width;\n  const rightY = Math.floor(element.height / 2) + 1;\n  const bottomX = topX;\n  const bottomY = element.height;\n  const leftX = topY;\n  const leftY = rightY;\n\n  return [topX, topY, rightX, rightY, bottomX, bottomY, leftX, leftY];\n}\n\nexport function getArrowPoints(element: ExcalidrawElement) {\n  const x1 = 0;\n  const y1 = 0;\n  const x2 = element.width;\n  const y2 = element.height;\n\n  const size = 30; // pixels\n  const distance = Math.hypot(x2 - x1, y2 - y1);\n  // Scale down the arrow until we hit a certain size so that it doesn't look weird\n  const minSize = Math.min(size, distance / 2);\n  const xs = x2 - ((x2 - x1) / distance) * minSize;\n  const ys = y2 - ((y2 - y1) / distance) * minSize;\n\n  const angle = 20; // degrees\n  const [x3, y3] = rotate(xs, ys, x2, y2, (-angle * Math.PI) / 180);\n  const [x4, y4] = rotate(xs, ys, x2, y2, (angle * Math.PI) / 180);\n\n  return [x1, y1, x2, y2, x3, y3, x4, y4];\n}\n\nexport function getLinePoints(element: ExcalidrawElement) {\n  const x1 = 0;\n  const y1 = 0;\n  const x2 = element.width;\n  const y2 = element.height;\n\n  return [x1, y1, x2, y2];\n}\n","import { ExcalidrawElement } from \"./types\";\nimport { SceneScroll } from \"../scene/types\";\n\ntype Sides = \"n\" | \"s\" | \"w\" | \"e\" | \"nw\" | \"ne\" | \"sw\" | \"se\";\n\nexport function handlerRectangles(\n  element: ExcalidrawElement,\n  { scrollX, scrollY }: SceneScroll\n) {\n  const elementX1 = element.x;\n  const elementX2 = element.x + element.width;\n  const elementY1 = element.y;\n  const elementY2 = element.y + element.height;\n\n  const margin = 4;\n  const minimumSize = 40;\n  const handlers = {} as { [T in Sides]: number[] };\n\n  const marginX = element.width < 0 ? 8 : -8;\n  const marginY = element.height < 0 ? 8 : -8;\n\n  if (Math.abs(elementX2 - elementX1) > minimumSize) {\n    handlers[\"n\"] = [\n      elementX1 + (elementX2 - elementX1) / 2 + scrollX - 4,\n      elementY1 - margin + scrollY + marginY,\n      8,\n      8\n    ];\n\n    handlers[\"s\"] = [\n      elementX1 + (elementX2 - elementX1) / 2 + scrollX - 4,\n      elementY2 - margin + scrollY - marginY,\n      8,\n      8\n    ];\n  }\n\n  if (Math.abs(elementY2 - elementY1) > minimumSize) {\n    handlers[\"w\"] = [\n      elementX1 - margin + scrollX + marginX,\n      elementY1 + (elementY2 - elementY1) / 2 + scrollY - 4,\n      8,\n      8\n    ];\n\n    handlers[\"e\"] = [\n      elementX2 - margin + scrollX - marginX,\n      elementY1 + (elementY2 - elementY1) / 2 + scrollY - 4,\n      8,\n      8\n    ];\n  }\n\n  handlers[\"nw\"] = [\n    elementX1 - margin + scrollX + marginX,\n    elementY1 - margin + scrollY + marginY,\n    8,\n    8\n  ]; // nw\n  handlers[\"ne\"] = [\n    elementX2 - margin + scrollX - marginX,\n    elementY1 - margin + scrollY + marginY,\n    8,\n    8\n  ]; // ne\n  handlers[\"sw\"] = [\n    elementX1 - margin + scrollX + marginX,\n    elementY2 - margin + scrollY - marginY,\n    8,\n    8\n  ]; // sw\n  handlers[\"se\"] = [\n    elementX2 - margin + scrollX - marginX,\n    elementY2 - margin + scrollY - marginY,\n    8,\n    8\n  ]; // se\n\n  if (element.type === \"arrow\" || element.type === \"line\") {\n    return {\n      nw: handlers.nw,\n      se: handlers.se\n    } as typeof handlers;\n  }\n\n  return handlers;\n}\n","import { distanceBetweenPointAndSegment } from \"../math\";\n\nimport { ExcalidrawElement } from \"./types\";\nimport {\n  getArrowPoints,\n  getDiamondPoints,\n  getElementAbsoluteCoords,\n  getLinePoints\n} from \"./bounds\";\n\nexport function hitTest(\n  element: ExcalidrawElement,\n  x: number,\n  y: number\n): boolean {\n  // For shapes that are composed of lines, we only enable point-selection when the distance\n  // of the click is less than x pixels of any of the lines that the shape is composed of\n  const lineThreshold = 10;\n\n  if (element.type === \"ellipse\") {\n    // https://stackoverflow.com/a/46007540/232122\n    const px = Math.abs(x - element.x - element.width / 2);\n    const py = Math.abs(y - element.y - element.height / 2);\n\n    let tx = 0.707;\n    let ty = 0.707;\n\n    const a = Math.abs(element.width) / 2;\n    const b = Math.abs(element.height) / 2;\n\n    [0, 1, 2, 3].forEach(x => {\n      const xx = a * tx;\n      const yy = b * ty;\n\n      const ex = ((a * a - b * b) * tx ** 3) / a;\n      const ey = ((b * b - a * a) * ty ** 3) / b;\n\n      const rx = xx - ex;\n      const ry = yy - ey;\n\n      const qx = px - ex;\n      const qy = py - ey;\n\n      const r = Math.hypot(ry, rx);\n      const q = Math.hypot(qy, qx);\n\n      tx = Math.min(1, Math.max(0, ((qx * r) / q + ex) / a));\n      ty = Math.min(1, Math.max(0, ((qy * r) / q + ey) / b));\n      const t = Math.hypot(ty, tx);\n      tx /= t;\n      ty /= t;\n    });\n\n    if (element.backgroundColor !== \"transparent\") {\n      return (\n        a * tx - (px - lineThreshold) >= 0 && b * ty - (py - lineThreshold) >= 0\n      );\n    } else {\n      return Math.hypot(a * tx - px, b * ty - py) < lineThreshold;\n    }\n  } else if (element.type === \"rectangle\") {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n\n    if (element.backgroundColor !== \"transparent\") {\n      return (\n        x > x1 - lineThreshold &&\n        x < x2 + lineThreshold &&\n        y > y1 - lineThreshold &&\n        y < y2 + lineThreshold\n      );\n    }\n\n    // (x1, y1) --A-- (x2, y1)\n    //    |D             |B\n    // (x1, y2) --C-- (x2, y2)\n    return (\n      distanceBetweenPointAndSegment(x, y, x1, y1, x2, y1) < lineThreshold || // A\n      distanceBetweenPointAndSegment(x, y, x2, y1, x2, y2) < lineThreshold || // B\n      distanceBetweenPointAndSegment(x, y, x2, y2, x1, y2) < lineThreshold || // C\n      distanceBetweenPointAndSegment(x, y, x1, y2, x1, y1) < lineThreshold // D\n    );\n  } else if (element.type === \"diamond\") {\n    x -= element.x;\n    y -= element.y;\n\n    let [\n      topX,\n      topY,\n      rightX,\n      rightY,\n      bottomX,\n      bottomY,\n      leftX,\n      leftY\n    ] = getDiamondPoints(element);\n\n    if (element.backgroundColor !== \"transparent\") {\n      // TODO: remove this when we normalize coordinates globally\n      if (topY > bottomY) [bottomY, topY] = [topY, bottomY];\n      if (rightX < leftX) [leftX, rightX] = [rightX, leftX];\n\n      topY -= lineThreshold;\n      bottomY += lineThreshold;\n      leftX -= lineThreshold;\n      rightX += lineThreshold;\n\n      // all deltas should be < 0. Delta > 0 indicates it's on the outside side\n      //  of the line.\n      //\n      //          (topX, topY)\n      //     D  /             \\ A\n      //      /               \\\n      //  (leftX, leftY)  (rightX, rightY)\n      //    C \\               / B\n      //      \\              /\n      //      (bottomX, bottomY)\n      //\n      // https://stackoverflow.com/a/2752753/927631\n      return (\n        // delta from line D\n        (leftX - topX) * (y - leftY) - (leftX - x) * (topY - leftY) <= 0 &&\n        // delta from line A\n        (topX - rightX) * (y - rightY) - (x - rightX) * (topY - rightY) <= 0 &&\n        // delta from line B\n        (rightX - bottomX) * (y - bottomY) -\n          (x - bottomX) * (rightY - bottomY) <=\n          0 &&\n        // delta from line C\n        (bottomX - leftX) * (y - leftY) - (x - leftX) * (bottomY - leftY) <= 0\n      );\n    }\n\n    return (\n      distanceBetweenPointAndSegment(x, y, topX, topY, rightX, rightY) <\n        lineThreshold ||\n      distanceBetweenPointAndSegment(x, y, rightX, rightY, bottomX, bottomY) <\n        lineThreshold ||\n      distanceBetweenPointAndSegment(x, y, bottomX, bottomY, leftX, leftY) <\n        lineThreshold ||\n      distanceBetweenPointAndSegment(x, y, leftX, leftY, topX, topY) <\n        lineThreshold\n    );\n  } else if (element.type === \"arrow\") {\n    let [x1, y1, x2, y2, x3, y3, x4, y4] = getArrowPoints(element);\n    // The computation is done at the origin, we need to add a translation\n    x -= element.x;\n    y -= element.y;\n\n    return (\n      //    \\\n      distanceBetweenPointAndSegment(x, y, x3, y3, x2, y2) < lineThreshold ||\n      // -----\n      distanceBetweenPointAndSegment(x, y, x1, y1, x2, y2) < lineThreshold ||\n      //    /\n      distanceBetweenPointAndSegment(x, y, x4, y4, x2, y2) < lineThreshold\n    );\n  } else if (element.type === \"line\") {\n    const [x1, y1, x2, y2] = getLinePoints(element);\n    // The computation is done at the origin, we need to add a translation\n    x -= element.x;\n    y -= element.y;\n\n    return distanceBetweenPointAndSegment(x, y, x1, y1, x2, y2) < lineThreshold;\n  } else if (element.type === \"text\") {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n\n    return x >= x1 && x <= x2 && y >= y1 && y <= y2;\n  } else if (element.type === \"selection\") {\n    console.warn(\"This should not happen, we need to investigate why it does.\");\n    return false;\n  } else {\n    throw new Error(\"Unimplemented type \" + element.type);\n  }\n}\n","import { ExcalidrawElement } from \"./types\";\n\nimport { handlerRectangles } from \"./handlerRectangles\";\nimport { SceneScroll } from \"../scene/types\";\n\ntype HandlerRectanglesRet = keyof ReturnType<typeof handlerRectangles>;\n\nexport function resizeTest(\n  element: ExcalidrawElement,\n  x: number,\n  y: number,\n  { scrollX, scrollY }: SceneScroll\n): HandlerRectanglesRet | false {\n  if (!element.isSelected || element.type === \"text\") return false;\n\n  const handlers = handlerRectangles(element, { scrollX, scrollY });\n\n  const filter = Object.keys(handlers).filter(key => {\n    const handler = handlers[key as HandlerRectanglesRet]!;\n\n    return (\n      x + scrollX >= handler[0] &&\n      x + scrollX <= handler[0] + handler[2] &&\n      y + scrollY >= handler[1] &&\n      y + scrollY <= handler[1] + handler[3]\n    );\n  });\n\n  if (filter.length > 0) {\n    return filter[0] as HandlerRectanglesRet;\n  }\n\n  return false;\n}\n\nexport function getElementWithResizeHandler(\n  elements: readonly ExcalidrawElement[],\n  { x, y }: { x: number; y: number },\n  { scrollX, scrollY }: SceneScroll\n) {\n  return elements.reduce((result, element) => {\n    if (result) {\n      return result;\n    }\n    const resizeHandle = resizeTest(element, x, y, {\n      scrollX,\n      scrollY\n    });\n    return resizeHandle ? { element, resizeHandle } : null;\n  }, null as { element: ExcalidrawElement; resizeHandle: ReturnType<typeof resizeTest> } | null);\n}\n","import { ExcalidrawElement, ExcalidrawTextElement } from \"./types\";\n\nexport function isTextElement(\n  element: ExcalidrawElement\n): element is ExcalidrawTextElement {\n  return element.type === \"text\";\n}\n","export const KEYS = {\n  ARROW_LEFT: \"ArrowLeft\",\n  ARROW_RIGHT: \"ArrowRight\",\n  ARROW_DOWN: \"ArrowDown\",\n  ARROW_UP: \"ArrowUp\",\n  ENTER: \"Enter\",\n  ESCAPE: \"Escape\",\n  DELETE: \"Delete\",\n  BACKSPACE: \"Backspace\"\n};\n\nexport const META_KEY = /Mac|iPod|iPhone|iPad/.test(window.navigator.platform)\n  ? \"metaKey\"\n  : \"ctrlKey\";\n\nexport function isArrowKey(keyCode: string) {\n  return (\n    keyCode === KEYS.ARROW_LEFT ||\n    keyCode === KEYS.ARROW_RIGHT ||\n    keyCode === KEYS.ARROW_DOWN ||\n    keyCode === KEYS.ARROW_UP\n  );\n}\n","export function getDateTime() {\n  const date = new Date();\n  const year = date.getFullYear();\n  const month = date.getMonth() + 1;\n  const day = date.getDate();\n  const hr = date.getHours();\n  const min = date.getMinutes();\n  const secs = date.getSeconds();\n\n  return `${year}${month}${day}${hr}${min}${secs}`;\n}\n\nexport function capitalizeString(str: string) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nexport function isInputLike(\n  target: Element | EventTarget | null\n): target is HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement {\n  return (\n    (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\n    target instanceof HTMLInputElement ||\n    target instanceof HTMLTextAreaElement ||\n    target instanceof HTMLSelectElement\n  );\n}\n\n// https://github.com/grassator/canvas-text-editor/blob/master/lib/FontMetrics.js\nexport function measureText(text: string, font: string) {\n  const line = document.createElement(\"div\");\n  const body = document.body;\n  line.style.position = \"absolute\";\n  line.style.whiteSpace = \"nowrap\";\n  line.style.font = font;\n  body.appendChild(line);\n  // Now we can measure width and height of the letter\n  line.innerText = text;\n  const width = line.offsetWidth;\n  const height = line.offsetHeight;\n  // Now creating 1px sized item that will be aligned to baseline\n  // to calculate baseline shift\n  const span = document.createElement(\"span\");\n  span.style.display = \"inline-block\";\n  span.style.overflow = \"hidden\";\n  span.style.width = \"1px\";\n  span.style.height = \"1px\";\n  line.appendChild(span);\n  // Baseline is important for positioning text on canvas\n  const baseline = span.offsetTop + span.offsetHeight;\n  document.body.removeChild(line);\n\n  return { width, height, baseline };\n}\n\nexport function debounce<T extends any[]>(\n  fn: (...args: T) => void,\n  timeout: number\n) {\n  let handle = 0;\n  return (...args: T) => {\n    clearTimeout(handle);\n    handle = window.setTimeout(() => fn(...args), timeout);\n  };\n}\n\nexport function selectNode(node: Element) {\n  const selection = window.getSelection();\n  if (selection) {\n    const range = document.createRange();\n    range.selectNodeContents(node);\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n}\n\nexport function removeSelection() {\n  const selection = window.getSelection();\n  if (selection) {\n    selection.removeAllRanges();\n  }\n}\n","import { KEYS } from \"../keys\";\nimport { selectNode } from \"../utils\";\n\ntype TextWysiwygParams = {\n  initText: string;\n  x: number;\n  y: number;\n  strokeColor: string;\n  font: string;\n  onSubmit: (text: string) => void;\n};\n\nexport function textWysiwyg({\n  initText,\n  x,\n  y,\n  strokeColor,\n  font,\n  onSubmit\n}: TextWysiwygParams) {\n  // Using contenteditable here as it has dynamic width.\n  // But this solution has an issue  it allows to paste\n  // multiline text, which is not currently supported\n  const editable = document.createElement(\"div\");\n  editable.contentEditable = \"true\";\n  editable.tabIndex = 0;\n  editable.innerText = initText;\n  editable.dataset.type = \"wysiwyg\";\n\n  Object.assign(editable.style, {\n    color: strokeColor,\n    position: \"absolute\",\n    top: y + \"px\",\n    left: x + \"px\",\n    transform: \"translate(-50%, -50%)\",\n    textAlign: \"center\",\n    display: \"inline-block\",\n    font: font,\n    padding: \"4px\",\n    outline: \"transparent\",\n    whiteSpace: \"nowrap\",\n    minHeight: \"1em\"\n  });\n\n  editable.onkeydown = ev => {\n    if (ev.key === KEYS.ESCAPE) {\n      ev.preventDefault();\n      if (initText) {\n        editable.innerText = initText;\n        handleSubmit();\n        return;\n      }\n      cleanup();\n      return;\n    }\n    if (ev.key === KEYS.ENTER) {\n      ev.preventDefault();\n      handleSubmit();\n    }\n  };\n  editable.onblur = handleSubmit;\n  // override paste to disallow non-textual data, and replace newlines\n  editable.onpaste = ev => {\n    ev.preventDefault();\n    try {\n      const text = ev.clipboardData!.getData(\"text\").replace(/\\n+/g, \" \");\n      editable.textContent = text;\n    } catch {}\n  };\n\n  function stopEvent(ev: Event) {\n    ev.stopPropagation();\n  }\n\n  function handleSubmit() {\n    if (editable.innerText) {\n      onSubmit(editable.innerText);\n    }\n    cleanup();\n  }\n\n  function cleanup() {\n    editable.onblur = null;\n    editable.onkeydown = null;\n    editable.onpaste = null;\n    window.removeEventListener(\"wheel\", stopEvent, true);\n    document.body.removeChild(editable);\n  }\n\n  window.addEventListener(\"wheel\", stopEvent, true);\n  document.body.appendChild(editable);\n  editable.focus();\n  selectNode(editable);\n}\n","import { measureText } from \"../utils\";\nimport { ExcalidrawTextElement } from \"./types\";\n\nexport const redrawTextBoundingBox = (element: ExcalidrawTextElement) => {\n  const metrics = measureText(element.text, element.font);\n  element.width = metrics.width;\n  element.height = metrics.height;\n  element.baseline = metrics.baseline;\n};\n","import { ExcalidrawElement } from \"../element/types\";\nimport { getElementAbsoluteCoords } from \"../element\";\n\nconst SCROLLBAR_MIN_SIZE = 15;\nconst SCROLLBAR_MARGIN = 4;\nexport const SCROLLBAR_WIDTH = 6;\nexport const SCROLLBAR_COLOR = \"rgba(0,0,0,0.3)\";\n\nexport function getScrollBars(\n  elements: readonly ExcalidrawElement[],\n  canvasWidth: number,\n  canvasHeight: number,\n  scrollX: number,\n  scrollY: number\n) {\n  let minX = Infinity;\n  let maxX = 0;\n  let minY = Infinity;\n  let maxY = 0;\n\n  elements.forEach(element => {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n    minX = Math.min(minX, x1);\n    minY = Math.min(minY, y1);\n    maxX = Math.max(maxX, x2);\n    maxY = Math.max(maxY, y2);\n  });\n\n  minX += scrollX;\n  maxX += scrollX;\n  minY += scrollY;\n  maxY += scrollY;\n  const leftOverflow = Math.max(-minX, 0);\n  const rightOverflow = Math.max(-(canvasWidth - maxX), 0);\n  const topOverflow = Math.max(-minY, 0);\n  const bottomOverflow = Math.max(-(canvasHeight - maxY), 0);\n\n  // horizontal scrollbar\n  let horizontalScrollBar = null;\n  if (leftOverflow || rightOverflow) {\n    horizontalScrollBar = {\n      x: Math.min(\n        leftOverflow + SCROLLBAR_MARGIN,\n        canvasWidth - SCROLLBAR_MIN_SIZE - SCROLLBAR_MARGIN\n      ),\n      y: canvasHeight - SCROLLBAR_WIDTH - SCROLLBAR_MARGIN,\n      width: Math.max(\n        canvasWidth - rightOverflow - leftOverflow - SCROLLBAR_MARGIN * 2,\n        SCROLLBAR_MIN_SIZE\n      ),\n      height: SCROLLBAR_WIDTH\n    };\n  }\n\n  // vertical scrollbar\n  let verticalScrollBar = null;\n  if (topOverflow || bottomOverflow) {\n    verticalScrollBar = {\n      x: canvasWidth - SCROLLBAR_WIDTH - SCROLLBAR_MARGIN,\n      y: Math.min(\n        topOverflow + SCROLLBAR_MARGIN,\n        canvasHeight - SCROLLBAR_MIN_SIZE - SCROLLBAR_MARGIN\n      ),\n      width: SCROLLBAR_WIDTH,\n      height: Math.max(\n        canvasHeight - bottomOverflow - topOverflow - SCROLLBAR_WIDTH * 2,\n        SCROLLBAR_MIN_SIZE\n      )\n    };\n  }\n\n  return {\n    horizontal: horizontalScrollBar,\n    vertical: verticalScrollBar\n  };\n}\n\nexport function isOverScrollBars(\n  elements: readonly ExcalidrawElement[],\n  x: number,\n  y: number,\n  canvasWidth: number,\n  canvasHeight: number,\n  scrollX: number,\n  scrollY: number\n) {\n  const scrollBars = getScrollBars(\n    elements,\n    canvasWidth,\n    canvasHeight,\n    scrollX,\n    scrollY\n  );\n\n  const [isOverHorizontalScrollBar, isOverVerticalScrollBar] = [\n    scrollBars.horizontal,\n    scrollBars.vertical\n  ].map(\n    scrollBar =>\n      scrollBar &&\n      scrollBar.x <= x &&\n      x <= scrollBar.x + scrollBar.width &&\n      scrollBar.y <= y &&\n      y <= scrollBar.y + scrollBar.height\n  );\n\n  return {\n    isOverHorizontalScrollBar,\n    isOverVerticalScrollBar\n  };\n}\n","import { ExcalidrawElement } from \"../element/types\";\nimport { getElementAbsoluteCoords } from \"../element\";\n\nexport function getElementsWithinSelection(\n  elements: readonly ExcalidrawElement[],\n  selection: ExcalidrawElement\n) {\n  const [\n    selectionX1,\n    selectionY1,\n    selectionX2,\n    selectionY2\n  ] = getElementAbsoluteCoords(selection);\n  return elements.filter(element => {\n    const [\n      elementX1,\n      elementY1,\n      elementX2,\n      elementY2\n    ] = getElementAbsoluteCoords(element);\n\n    return (\n      element.type !== \"selection\" &&\n      selectionX1 <= elementX1 &&\n      selectionY1 <= elementY1 &&\n      selectionX2 >= elementX2 &&\n      selectionY2 >= elementY2\n    );\n  });\n}\n\nexport function clearSelection(elements: readonly ExcalidrawElement[]) {\n  const newElements = [...elements];\n\n  newElements.forEach(element => {\n    element.isSelected = false;\n  });\n\n  return newElements;\n}\n\nexport function deleteSelectedElements(elements: readonly ExcalidrawElement[]) {\n  return elements.filter(el => !el.isSelected);\n}\n\nexport function getSelectedIndices(elements: readonly ExcalidrawElement[]) {\n  const selectedIndices: number[] = [];\n  elements.forEach((element, index) => {\n    if (element.isSelected) {\n      selectedIndices.push(index);\n    }\n  });\n  return selectedIndices;\n}\n\nexport const someElementIsSelected = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(element => element.isSelected);\n\nexport function getSelectedAttribute<T>(\n  elements: readonly ExcalidrawElement[],\n  getAttribute: (element: ExcalidrawElement) => T\n): T | null {\n  const attributes = Array.from(\n    new Set(\n      elements\n        .filter(element => element.isSelected)\n        .map(element => getAttribute(element))\n    )\n  );\n  return attributes.length === 1 ? attributes[0] : null;\n}\n","import { AppState } from \"./types\";\nimport { getDateTime } from \"./utils\";\n\nconst DEFAULT_PROJECT_NAME = `excalidraw-${getDateTime()}`;\n\nexport function getDefaultAppState(): AppState {\n  return {\n    draggingElement: null,\n    resizingElement: null,\n    elementType: \"selection\",\n    exportBackground: true,\n    currentItemStrokeColor: \"#000000\",\n    currentItemBackgroundColor: \"transparent\",\n    currentItemFont: \"20px Virgil\",\n    viewBackgroundColor: \"#ffffff\",\n    scrollX: 0,\n    scrollY: 0,\n    cursorX: 0,\n    cursorY: 0,\n    name: DEFAULT_PROJECT_NAME\n  };\n}\n","/**\n * https://stackoverflow.com/a/3368118\n * Draws a rounded rectangle using the current state of the canvas.\n * @param {CanvasRenderingContext2D} context\n * @param {Number} x The top left x coordinate\n * @param {Number} y The top left y coordinate\n * @param {Number} width The width of the rectangle\n * @param {Number} height The height of the rectangle\n * @param {Number} radius The corner radius\n */\nexport function roundRect(\n  context: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number\n) {\n  context.beginPath();\n  context.moveTo(x + radius, y);\n  context.lineTo(x + width - radius, y);\n  context.quadraticCurveTo(x + width, y, x + width, y + radius);\n  context.lineTo(x + width, y + height - radius);\n  context.quadraticCurveTo(\n    x + width,\n    y + height,\n    x + width - radius,\n    y + height\n  );\n  context.lineTo(x + radius, y + height);\n  context.quadraticCurveTo(x, y + height, x, y + height - radius);\n  context.lineTo(x, y + radius);\n  context.quadraticCurveTo(x, y, x + radius, y);\n  context.closePath();\n  context.fill();\n  context.stroke();\n}\n","import { ExcalidrawElement } from \"../element/types\";\nimport { isTextElement } from \"../element/typeChecks\";\nimport {\n  getDiamondPoints,\n  getArrowPoints,\n  getLinePoints\n} from \"../element/bounds\";\nimport { RoughCanvas } from \"roughjs/bin/canvas\";\nimport { Drawable } from \"roughjs/bin/core\";\n\nexport function renderElement(\n  element: ExcalidrawElement,\n  rc: RoughCanvas,\n  context: CanvasRenderingContext2D\n) {\n  const generator = rc.generator;\n  if (element.type === \"selection\") {\n    const fillStyle = context.fillStyle;\n    context.fillStyle = \"rgba(0, 0, 255, 0.10)\";\n    context.fillRect(0, 0, element.width, element.height);\n    context.fillStyle = fillStyle;\n  } else if (element.type === \"rectangle\") {\n    if (!element.shape) {\n      element.shape = generator.rectangle(0, 0, element.width, element.height, {\n        stroke: element.strokeColor,\n        fill:\n          element.backgroundColor === \"transparent\"\n            ? undefined\n            : element.backgroundColor,\n        fillStyle: element.fillStyle,\n        strokeWidth: element.strokeWidth,\n        roughness: element.roughness,\n        seed: element.seed\n      });\n    }\n\n    context.globalAlpha = element.opacity / 100;\n    rc.draw(element.shape as Drawable);\n    context.globalAlpha = 1;\n  } else if (element.type === \"diamond\") {\n    if (!element.shape) {\n      const [\n        topX,\n        topY,\n        rightX,\n        rightY,\n        bottomX,\n        bottomY,\n        leftX,\n        leftY\n      ] = getDiamondPoints(element);\n      element.shape = generator.polygon(\n        [\n          [topX, topY],\n          [rightX, rightY],\n          [bottomX, bottomY],\n          [leftX, leftY]\n        ],\n        {\n          stroke: element.strokeColor,\n          fill:\n            element.backgroundColor === \"transparent\"\n              ? undefined\n              : element.backgroundColor,\n          fillStyle: element.fillStyle,\n          strokeWidth: element.strokeWidth,\n          roughness: element.roughness,\n          seed: element.seed\n        }\n      );\n    }\n\n    context.globalAlpha = element.opacity / 100;\n    rc.draw(element.shape as Drawable);\n    context.globalAlpha = 1;\n  } else if (element.type === \"ellipse\") {\n    if (!element.shape) {\n      element.shape = generator.ellipse(\n        element.width / 2,\n        element.height / 2,\n        element.width,\n        element.height,\n        {\n          stroke: element.strokeColor,\n          fill:\n            element.backgroundColor === \"transparent\"\n              ? undefined\n              : element.backgroundColor,\n          fillStyle: element.fillStyle,\n          strokeWidth: element.strokeWidth,\n          roughness: element.roughness,\n          seed: element.seed,\n          curveFitting: 1\n        }\n      );\n    }\n\n    context.globalAlpha = element.opacity / 100;\n    rc.draw(element.shape as Drawable);\n    context.globalAlpha = 1;\n  } else if (element.type === \"arrow\") {\n    const [x1, y1, x2, y2, x3, y3, x4, y4] = getArrowPoints(element);\n    const options = {\n      stroke: element.strokeColor,\n      strokeWidth: element.strokeWidth,\n      roughness: element.roughness,\n      seed: element.seed\n    };\n\n    if (!element.shape) {\n      element.shape = [\n        //    \\\n        generator.line(x3, y3, x2, y2, options),\n        // -----\n        generator.line(x1, y1, x2, y2, options),\n        //    /\n        generator.line(x4, y4, x2, y2, options)\n      ];\n    }\n\n    context.globalAlpha = element.opacity / 100;\n    (element.shape as Drawable[]).forEach(shape => rc.draw(shape));\n    context.globalAlpha = 1;\n    return;\n  } else if (element.type === \"line\") {\n    const [x1, y1, x2, y2] = getLinePoints(element);\n    const options = {\n      stroke: element.strokeColor,\n      strokeWidth: element.strokeWidth,\n      roughness: element.roughness,\n      seed: element.seed\n    };\n\n    if (!element.shape) {\n      element.shape = generator.line(x1, y1, x2, y2, options);\n    }\n\n    context.globalAlpha = element.opacity / 100;\n    rc.draw(element.shape as Drawable);\n    context.globalAlpha = 1;\n  } else if (isTextElement(element)) {\n    context.globalAlpha = element.opacity / 100;\n    const font = context.font;\n    context.font = element.font;\n    const fillStyle = context.fillStyle;\n    context.fillStyle = element.strokeColor;\n    context.fillText(\n      element.text,\n      0,\n      element.baseline || element.actualBoundingBoxAscent || 0\n    );\n    context.fillStyle = fillStyle;\n    context.font = font;\n    context.globalAlpha = 1;\n  } else {\n    throw new Error(\"Unimplemented type \" + element.type);\n  }\n}\n","import { RoughCanvas } from \"roughjs/bin/canvas\";\n\nimport { ExcalidrawElement } from \"../element/types\";\nimport { getElementAbsoluteCoords, handlerRectangles } from \"../element\";\n\nimport { roundRect } from \"./roundRect\";\nimport { SceneState } from \"../scene/types\";\nimport {\n  getScrollBars,\n  SCROLLBAR_COLOR,\n  SCROLLBAR_WIDTH\n} from \"../scene/scrollbars\";\n\nimport { renderElement } from \"./renderElement\";\n\nexport function renderScene(\n  elements: readonly ExcalidrawElement[],\n  rc: RoughCanvas,\n  canvas: HTMLCanvasElement,\n  sceneState: SceneState,\n  // extra options, currently passed by export helper\n  {\n    offsetX,\n    offsetY,\n    renderScrollbars = true,\n    renderSelection = true\n  }: {\n    offsetX?: number;\n    offsetY?: number;\n    renderScrollbars?: boolean;\n    renderSelection?: boolean;\n  } = {}\n) {\n  if (!canvas) return;\n  const context = canvas.getContext(\"2d\")!;\n\n  const fillStyle = context.fillStyle;\n  if (typeof sceneState.viewBackgroundColor === \"string\") {\n    context.fillStyle = sceneState.viewBackgroundColor;\n    context.fillRect(0, 0, canvas.width, canvas.height);\n  } else {\n    context.clearRect(0, 0, canvas.width, canvas.height);\n  }\n  context.fillStyle = fillStyle;\n\n  sceneState = {\n    ...sceneState,\n    scrollX: typeof offsetX === \"number\" ? offsetX : sceneState.scrollX,\n    scrollY: typeof offsetY === \"number\" ? offsetY : sceneState.scrollY\n  };\n\n  elements.forEach(element => {\n    context.translate(\n      element.x + sceneState.scrollX,\n      element.y + sceneState.scrollY\n    );\n    renderElement(element, rc, context);\n    context.translate(\n      -element.x - sceneState.scrollX,\n      -element.y - sceneState.scrollY\n    );\n  });\n\n  if (renderSelection) {\n    const selectedElements = elements.filter(el => el.isSelected);\n\n    selectedElements.forEach(element => {\n      const margin = 4;\n\n      const [\n        elementX1,\n        elementY1,\n        elementX2,\n        elementY2\n      ] = getElementAbsoluteCoords(element);\n      const lineDash = context.getLineDash();\n      context.setLineDash([8, 4]);\n      context.strokeRect(\n        elementX1 - margin + sceneState.scrollX,\n        elementY1 - margin + sceneState.scrollY,\n        elementX2 - elementX1 + margin * 2,\n        elementY2 - elementY1 + margin * 2\n      );\n      context.setLineDash(lineDash);\n    });\n\n    if (selectedElements.length === 1 && selectedElements[0].type !== \"text\") {\n      const handlers = handlerRectangles(selectedElements[0], sceneState);\n      Object.values(handlers).forEach(handler => {\n        context.strokeRect(handler[0], handler[1], handler[2], handler[3]);\n      });\n    }\n  }\n\n  if (renderScrollbars) {\n    const scrollBars = getScrollBars(\n      elements,\n      context.canvas.width / window.devicePixelRatio,\n      context.canvas.height / window.devicePixelRatio,\n      sceneState.scrollX,\n      sceneState.scrollY\n    );\n\n    const strokeStyle = context.strokeStyle;\n    context.fillStyle = SCROLLBAR_COLOR;\n    context.strokeStyle = \"rgba(255,255,255,0.8)\";\n    [scrollBars.horizontal, scrollBars.vertical].forEach(scrollBar => {\n      if (scrollBar)\n        roundRect(\n          context,\n          scrollBar.x,\n          scrollBar.y,\n          scrollBar.width,\n          scrollBar.height,\n          SCROLLBAR_WIDTH / 2\n        );\n    });\n    context.strokeStyle = strokeStyle;\n    context.fillStyle = fillStyle;\n  }\n}\n","import rough from \"roughjs/bin/rough\";\n\nimport { ExcalidrawElement } from \"../element/types\";\n\nimport { getElementAbsoluteCoords } from \"../element\";\nimport { getDefaultAppState } from \"../appState\";\n\nimport { renderScene } from \"../renderer\";\nimport { AppState } from \"../types\";\nimport { ExportType } from \"./types\";\nimport nanoid from \"nanoid\";\n\nconst LOCAL_STORAGE_KEY = \"excalidraw\";\nconst LOCAL_STORAGE_KEY_STATE = \"excalidraw-state\";\n\nfunction saveFile(name: string, data: string) {\n  // create a temporary <a> elem which we'll use to download the image\n  const link = document.createElement(\"a\");\n  link.setAttribute(\"download\", name);\n  link.setAttribute(\"href\", data);\n  link.click();\n\n  // clean up\n  link.remove();\n}\n\ninterface DataState {\n  elements: readonly ExcalidrawElement[];\n  appState: AppState;\n}\n\nexport function saveAsJSON(\n  elements: readonly ExcalidrawElement[],\n  appState: AppState\n) {\n  const serialized = JSON.stringify({\n    version: 1,\n    source: window.location.origin,\n    elements: elements.map(({ shape, ...el }) => el),\n    appState: appState\n  });\n\n  saveFile(\n    `${appState.name}.json`,\n    \"data:text/plain;charset=utf-8,\" + encodeURIComponent(serialized)\n  );\n}\n\nexport function loadFromJSON() {\n  const input = document.createElement(\"input\");\n  const reader = new FileReader();\n  input.type = \"file\";\n  input.accept = \".json\";\n\n  input.onchange = () => {\n    if (!input.files!.length) {\n      alert(\"A file was not selected.\");\n      return;\n    }\n\n    reader.readAsText(input.files![0], \"utf8\");\n  };\n\n  input.click();\n\n  return new Promise<DataState>(resolve => {\n    reader.onloadend = () => {\n      if (reader.readyState === FileReader.DONE) {\n        const defaultAppState = getDefaultAppState();\n        let elements = [];\n        let appState = defaultAppState;\n        try {\n          const data = JSON.parse(reader.result as string);\n          elements = data.elements || [];\n          appState = { ...defaultAppState, ...data.appState };\n        } catch (e) {\n          // Do nothing because elements array is already empty\n        }\n        resolve(restore(elements, appState));\n      }\n    };\n  });\n}\n\nexport function getExportCanvasPreview(\n  elements: readonly ExcalidrawElement[],\n  {\n    exportBackground,\n    exportPadding = 10,\n    viewBackgroundColor\n  }: {\n    exportBackground: boolean;\n    exportPadding?: number;\n    viewBackgroundColor: string;\n  }\n) {\n  // calculate smallest area to fit the contents in\n  let subCanvasX1 = Infinity;\n  let subCanvasX2 = 0;\n  let subCanvasY1 = Infinity;\n  let subCanvasY2 = 0;\n\n  elements.forEach(element => {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n    subCanvasX1 = Math.min(subCanvasX1, x1);\n    subCanvasY1 = Math.min(subCanvasY1, y1);\n    subCanvasX2 = Math.max(subCanvasX2, x2);\n    subCanvasY2 = Math.max(subCanvasY2, y2);\n  });\n\n  function distance(x: number, y: number) {\n    return Math.abs(x > y ? x - y : y - x);\n  }\n\n  const tempCanvas = document.createElement(\"canvas\");\n  tempCanvas.width = distance(subCanvasX1, subCanvasX2) + exportPadding * 2;\n  tempCanvas.height = distance(subCanvasY1, subCanvasY2) + exportPadding * 2;\n\n  renderScene(\n    elements,\n    rough.canvas(tempCanvas),\n    tempCanvas,\n    {\n      viewBackgroundColor: exportBackground ? viewBackgroundColor : null,\n      scrollX: 0,\n      scrollY: 0\n    },\n    {\n      offsetX: -subCanvasX1 + exportPadding,\n      offsetY: -subCanvasY1 + exportPadding,\n      renderScrollbars: false,\n      renderSelection: false\n    }\n  );\n  return tempCanvas;\n}\n\nexport function exportCanvas(\n  type: ExportType,\n  elements: readonly ExcalidrawElement[],\n  canvas: HTMLCanvasElement,\n  {\n    exportBackground,\n    exportPadding = 10,\n    viewBackgroundColor,\n    name\n  }: {\n    exportBackground: boolean;\n    exportPadding?: number;\n    viewBackgroundColor: string;\n    scrollX: number;\n    scrollY: number;\n    name: string;\n  }\n) {\n  if (!elements.length) return window.alert(\"Cannot export empty canvas.\");\n  // calculate smallest area to fit the contents in\n\n  let subCanvasX1 = Infinity;\n  let subCanvasX2 = 0;\n  let subCanvasY1 = Infinity;\n  let subCanvasY2 = 0;\n\n  elements.forEach(element => {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\n    subCanvasX1 = Math.min(subCanvasX1, x1);\n    subCanvasY1 = Math.min(subCanvasY1, y1);\n    subCanvasX2 = Math.max(subCanvasX2, x2);\n    subCanvasY2 = Math.max(subCanvasY2, y2);\n  });\n\n  function distance(x: number, y: number) {\n    return Math.abs(x > y ? x - y : y - x);\n  }\n\n  const tempCanvas = document.createElement(\"canvas\");\n  tempCanvas.style.display = \"none\";\n  document.body.appendChild(tempCanvas);\n  tempCanvas.width = distance(subCanvasX1, subCanvasX2) + exportPadding * 2;\n  tempCanvas.height = distance(subCanvasY1, subCanvasY2) + exportPadding * 2;\n\n  renderScene(\n    elements,\n    rough.canvas(tempCanvas),\n    tempCanvas,\n    {\n      viewBackgroundColor: exportBackground ? viewBackgroundColor : null,\n      scrollX: 0,\n      scrollY: 0\n    },\n    {\n      offsetX: -subCanvasX1 + exportPadding,\n      offsetY: -subCanvasY1 + exportPadding,\n      renderScrollbars: false,\n      renderSelection: false\n    }\n  );\n\n  if (type === \"png\") {\n    saveFile(`${name}.png`, tempCanvas.toDataURL(\"image/png\"));\n  } else if (type === \"clipboard\") {\n    try {\n      tempCanvas.toBlob(async function(blob) {\n        try {\n          await navigator.clipboard.write([\n            new window.ClipboardItem({ \"image/png\": blob })\n          ]);\n        } catch (err) {\n          window.alert(\"Couldn't copy to clipboard. Try using Chrome browser.\");\n        }\n      });\n    } catch (err) {\n      window.alert(\"Couldn't copy to clipboard. Try using Chrome browser.\");\n    }\n  }\n\n  // clean up the DOM\n  if (tempCanvas !== canvas) tempCanvas.remove();\n}\n\nfunction restore(\n  savedElements: readonly ExcalidrawElement[],\n  savedState: AppState\n): DataState {\n  return {\n    elements: savedElements.map(element => ({\n      ...element,\n      id: element.id || nanoid(),\n      fillStyle: element.fillStyle || \"hachure\",\n      strokeWidth: element.strokeWidth || 1,\n      roughness: element.roughness || 1,\n      opacity:\n        element.opacity === null || element.opacity === undefined\n          ? 100\n          : element.opacity\n    })),\n    appState: savedState\n  };\n}\n\nexport function restoreFromLocalStorage() {\n  const savedElements = localStorage.getItem(LOCAL_STORAGE_KEY);\n  const savedState = localStorage.getItem(LOCAL_STORAGE_KEY_STATE);\n\n  let elements = [];\n  if (savedElements) {\n    try {\n      elements = JSON.parse(savedElements).map(\n        ({ shape, ...element }: ExcalidrawElement) => element\n      );\n    } catch (e) {\n      // Do nothing because elements array is already empty\n    }\n  }\n\n  let appState = null;\n  if (savedState) {\n    try {\n      appState = JSON.parse(savedState);\n    } catch (e) {\n      // Do nothing because appState is already null\n    }\n  }\n\n  return restore(elements, appState);\n}\n\nexport function saveToLocalStorage(\n  elements: readonly ExcalidrawElement[],\n  state: AppState\n) {\n  localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(elements));\n  localStorage.setItem(LOCAL_STORAGE_KEY_STATE, JSON.stringify(state));\n}\n","import { ExcalidrawElement } from \"../element/types\";\nimport { hitTest } from \"../element/collision\";\nimport { getElementAbsoluteCoords } from \"../element\";\n\nexport const hasBackground = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(\n    element =>\n      element.isSelected &&\n      (element.type === \"rectangle\" ||\n        element.type === \"ellipse\" ||\n        element.type === \"diamond\")\n  );\n\nexport const hasStroke = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(\n    element =>\n      element.isSelected &&\n      (element.type === \"rectangle\" ||\n        element.type === \"ellipse\" ||\n        element.type === \"diamond\" ||\n        element.type === \"arrow\" ||\n        element.type === \"line\")\n  );\n\nexport const hasText = (elements: readonly ExcalidrawElement[]) =>\n  elements.some(element => element.isSelected && element.type === \"text\");\n\nexport function getElementAtPosition(\n  elements: readonly ExcalidrawElement[],\n  x: number,\n  y: number\n) {\n  let hitElement = null;\n  // We need to to hit testing from front (end of the array) to back (beginning of the array)\n  for (let i = elements.length - 1; i >= 0; --i) {\n    if (hitTest(elements[i], x, y)) {\n      hitElement = elements[i];\n      break;\n    }\n  }\n\n  return hitElement;\n}\n\nexport function getElementContainingPosition(\n  elements: readonly ExcalidrawElement[],\n  x: number,\n  y: number\n) {\n  let hitElement = null;\n  // We need to to hit testing from front (end of the array) to back (beginning of the array)\n  for (let i = elements.length - 1; i >= 0; --i) {\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(elements[i]);\n    if (x1 < x && x < x2 && y1 < y && y < y2) {\n      hitElement = elements[i];\n      break;\n    }\n  }\n  return hitElement;\n}\n","import { ExcalidrawElement } from \"../element/types\";\n\nexport const createScene = () => {\n  const elements: readonly ExcalidrawElement[] = [];\n  return { elements };\n};\n","import React from \"react\";\n\n// We inline font-awesome icons in order to save on js size rather than including the font awesome react library\nexport const SHAPES = [\n  {\n    icon: (\n      // fa-mouse-pointer\n      <svg viewBox=\"0 0 320 512\">\n        <path d=\"M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141z\" />\n      </svg>\n    ),\n    value: \"selection\"\n  },\n  {\n    icon: (\n      // fa-square\n      <svg viewBox=\"0 0 448 512\">\n        <path d=\"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z\" />\n      </svg>\n    ),\n    value: \"rectangle\"\n  },\n  {\n    icon: (\n      // custom\n      <svg viewBox=\"0 0 223.646 223.646\">\n        <path d=\"M111.823 0L16.622 111.823 111.823 223.646 207.025 111.823z\" />\n      </svg>\n    ),\n    value: \"diamond\"\n  },\n  {\n    icon: (\n      // fa-circle\n      <svg viewBox=\"0 0 512 512\">\n        <path d=\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z\" />\n      </svg>\n    ),\n    value: \"ellipse\"\n  },\n  {\n    icon: (\n      // fa-long-arrow-alt-right\n      <svg viewBox=\"0 0 448 512\">\n        <path d=\"M313.941 216H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h301.941v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.569 0-33.941l-86.059-86.059c-15.119-15.119-40.971-4.411-40.971 16.971V216z\" />\n      </svg>\n    ),\n    value: \"arrow\"\n  },\n  {\n    icon: (\n      // fa-font\n      <svg viewBox=\"0 0 448 512\">\n        <path d=\"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z\" />\n      </svg>\n    ),\n    value: \"text\"\n  },\n  {\n    icon: (\n      // custom\n      <svg viewBox=\"0 0 6 6\">\n        <line\n          x1=\"0\"\n          y1=\"3\"\n          x2=\"6\"\n          y2=\"3\"\n          stroke=\"black\"\n          strokeLinecap=\"round\"\n        />\n      </svg>\n    ),\n    value: \"line\"\n  }\n];\n\nexport const shapesShortcutKeys = SHAPES.map(shape => shape.value[0]);\n\nexport function findShapeByKey(key: string) {\n  const defaultElement = \"selection\";\n  return SHAPES.reduce((element, shape) => {\n    if (shape.value[0] !== key) return element;\n\n    return shape.value;\n  }, defaultElement);\n}\n","import { ExcalidrawElement } from \"./element/types\";\n\nclass SceneHistory {\n  private recording: boolean = true;\n  private stateHistory: string[] = [];\n  private redoStack: string[] = [];\n\n  generateCurrentEntry(elements: readonly ExcalidrawElement[]) {\n    return JSON.stringify(\n      elements.map(({ shape, ...element }) => ({\n        ...element,\n        isSelected: false\n      }))\n    );\n  }\n\n  pushEntry(newEntry: string) {\n    if (\n      this.stateHistory.length > 0 &&\n      this.stateHistory[this.stateHistory.length - 1] === newEntry\n    ) {\n      // If the last entry is the same as this one, ignore it\n      return;\n    }\n\n    this.stateHistory.push(newEntry);\n\n    // As a new entry was pushed, we invalidate the redo stack\n    this.clearRedoStack();\n  }\n\n  restoreEntry(entry: string) {\n    try {\n      return JSON.parse(entry);\n    } catch {\n      return null;\n    }\n  }\n\n  clearRedoStack() {\n    this.redoStack.splice(0, this.redoStack.length);\n  }\n\n  redoOnce() {\n    if (this.redoStack.length === 0) {\n      return null;\n    }\n\n    const entryToRestore = this.redoStack.pop();\n\n    if (entryToRestore !== undefined) {\n      this.stateHistory.push(entryToRestore);\n      return this.restoreEntry(entryToRestore);\n    }\n\n    return null;\n  }\n\n  undoOnce() {\n    if (this.stateHistory.length === 0) {\n      return null;\n    }\n\n    const currentEntry = this.stateHistory.pop();\n    const entryToRestore = this.stateHistory[this.stateHistory.length - 1];\n\n    if (currentEntry !== undefined) {\n      this.redoStack.push(currentEntry);\n      return this.restoreEntry(entryToRestore);\n    }\n\n    return null;\n  }\n\n  isRecording() {\n    return this.recording;\n  }\n\n  skipRecording() {\n    this.recording = false;\n  }\n\n  resumeRecording() {\n    this.recording = true;\n  }\n}\n\nexport const createHistory: () => { history: SceneHistory } = () => {\n  const history = new SceneHistory();\n  return { history };\n};\n","import React, { useLayoutEffect, useRef } from \"react\";\nimport \"./Popover.css\";\n\ntype Props = {\n  top?: number;\n  left?: number;\n  children?: React.ReactNode;\n  onCloseRequest?(): void;\n  fitInViewport?: boolean;\n};\n\nexport function Popover({\n  children,\n  left,\n  top,\n  onCloseRequest,\n  fitInViewport = false\n}: Props) {\n  const popoverRef = useRef<HTMLDivElement>(null);\n\n  // ensure the popover doesn't overflow the viewport\n  useLayoutEffect(() => {\n    if (fitInViewport && popoverRef.current) {\n      const element = popoverRef.current;\n      const { x, y, width, height } = element.getBoundingClientRect();\n\n      const viewportWidth = window.innerWidth;\n      if (x + width > viewportWidth) {\n        element.style.left = viewportWidth - width + \"px\";\n      }\n      const viewportHeight = window.innerHeight;\n      if (y + height > viewportHeight) {\n        element.style.top = viewportHeight - height + \"px\";\n      }\n    }\n  }, [fitInViewport]);\n\n  return (\n    <div className=\"popover\" style={{ top: top, left: left }} ref={popoverRef}>\n      <div\n        className=\"cover\"\n        onClick={onCloseRequest}\n        onContextMenu={e => {\n          e.preventDefault();\n          if (onCloseRequest) onCloseRequest();\n        }}\n      />\n      {children}\n    </div>\n  );\n}\n","import React from \"react\";\nimport { Popover } from \"./Popover\";\nimport { render, unmountComponentAtNode } from \"react-dom\";\n\nimport \"./ContextMenu.css\";\n\ntype ContextMenuOption = {\n  label: string;\n  action(): void;\n};\n\ntype Props = {\n  options: ContextMenuOption[];\n  onCloseRequest?(): void;\n  top: number;\n  left: number;\n};\n\nfunction ContextMenu({ options, onCloseRequest, top, left }: Props) {\n  return (\n    <Popover\n      onCloseRequest={onCloseRequest}\n      top={top}\n      left={left}\n      fitInViewport={true}\n    >\n      <ul className=\"context-menu\" onContextMenu={e => e.preventDefault()}>\n        {options.map((option, idx) => (\n          <li\n            key={idx}\n            className=\"context-menu__option\"\n            onClick={onCloseRequest}\n          >\n            <ContextMenuOption {...option} />\n          </li>\n        ))}\n      </ul>\n    </Popover>\n  );\n}\n\nfunction ContextMenuOption({ label, action }: ContextMenuOption) {\n  return (\n    <button className=\"context-menu-option\" onClick={action}>\n      {label}\n    </button>\n  );\n}\n\nlet contextMenuNode: HTMLDivElement;\nfunction getContextMenuNode(): HTMLDivElement {\n  if (contextMenuNode) {\n    return contextMenuNode;\n  }\n  const div = document.createElement(\"div\");\n  document.body.appendChild(div);\n  return (contextMenuNode = div);\n}\n\ntype ContextMenuParams = {\n  options: (ContextMenuOption | false | null | undefined)[];\n  top: number;\n  left: number;\n};\n\nfunction handleClose() {\n  unmountComponentAtNode(getContextMenuNode());\n}\n\nexport default {\n  push(params: ContextMenuParams) {\n    const options = Array.of<ContextMenuOption>();\n    params.options.forEach(option => {\n      if (option) {\n        options.push(option);\n      }\n    });\n    if (options.length) {\n      render(\n        <ContextMenu\n          top={params.top}\n          left={params.left}\n          options={options}\n          onCloseRequest={handleClose}\n        />,\n        getContextMenuNode()\n      );\n    }\n  }\n};\n","import React from \"react\";\nimport {\n  Action,\n  ActionsManagerInterface,\n  UpdaterFn,\n  ActionFilterFn\n} from \"./types\";\nimport { ExcalidrawElement } from \"../element/types\";\nimport { AppState } from \"../types\";\n\nexport class ActionManager implements ActionsManagerInterface {\n  actions: { [keyProp: string]: Action } = {};\n\n  updater:\n    | ((elements: ExcalidrawElement[], appState: AppState) => void)\n    | null = null;\n\n  setUpdater(\n    updater: (elements: ExcalidrawElement[], appState: AppState) => void\n  ) {\n    this.updater = updater;\n  }\n\n  registerAction(action: Action) {\n    this.actions[action.name] = action;\n  }\n\n  handleKeyDown(\n    event: KeyboardEvent,\n    elements: readonly ExcalidrawElement[],\n    appState: AppState\n  ) {\n    const data = Object.values(this.actions)\n      .sort((a, b) => (b.keyPriority || 0) - (a.keyPriority || 0))\n      .filter(\n        action => action.keyTest && action.keyTest(event, elements, appState)\n      );\n\n    if (data.length === 0) return {};\n\n    event.preventDefault();\n    return data[0].perform(elements, appState, null);\n  }\n\n  getContextMenuItems(\n    elements: readonly ExcalidrawElement[],\n    appState: AppState,\n    updater: UpdaterFn,\n    actionFilter: ActionFilterFn = action => action\n  ) {\n    return Object.values(this.actions)\n      .filter(actionFilter)\n      .filter(action => \"contextItemLabel\" in action)\n      .sort(\n        (a, b) =>\n          (a.contextMenuOrder !== undefined ? a.contextMenuOrder : 999) -\n          (b.contextMenuOrder !== undefined ? b.contextMenuOrder : 999)\n      )\n      .map(action => ({\n        label: action.contextItemLabel!,\n        action: () => {\n          updater(action.perform(elements, appState, null));\n        }\n      }));\n  }\n\n  renderAction(\n    name: string,\n    elements: readonly ExcalidrawElement[],\n    appState: AppState,\n    updater: UpdaterFn\n  ) {\n    if (this.actions[name] && \"PanelComponent\" in this.actions[name]) {\n      const action = this.actions[name];\n      const PanelComponent = action.PanelComponent!;\n      const updateData = (formState: any) => {\n        updater(action.perform(elements, appState, formState));\n      };\n\n      return (\n        <PanelComponent\n          elements={elements}\n          appState={appState}\n          updateData={updateData}\n        />\n      );\n    }\n\n    return null;\n  }\n}\n","import { Action } from \"./types\";\nimport { deleteSelectedElements } from \"../scene\";\nimport { KEYS } from \"../keys\";\n\nexport const actionDeleteSelected: Action = {\n  name: \"deleteSelectedElements\",\n  perform: elements => {\n    return {\n      elements: deleteSelectedElements(elements)\n    };\n  },\n  contextItemLabel: \"Delete\",\n  contextMenuOrder: 3,\n  keyTest: event => event.key === KEYS.BACKSPACE || event.key === KEYS.DELETE\n};\n","function swap<T>(elements: T[], indexA: number, indexB: number) {\n  const element = elements[indexA];\n  elements[indexA] = elements[indexB];\n  elements[indexB] = element;\n}\n\nexport function moveOneLeft<T>(elements: T[], indicesToMove: number[]) {\n  indicesToMove.sort((a: number, b: number) => a - b);\n  let isSorted = true;\n  // We go from left to right to avoid overriding the wrong elements\n  indicesToMove.forEach((index, i) => {\n    // We don't want to bubble the first elements that are sorted as they are\n    // already in their correct position\n    isSorted = isSorted && index === i;\n    if (isSorted) {\n      return;\n    }\n    swap(elements, index - 1, index);\n  });\n\n  return elements;\n}\n\nexport function moveOneRight<T>(elements: T[], indicesToMove: number[]) {\n  const reversedIndicesToMove = indicesToMove.sort(\n    (a: number, b: number) => b - a\n  );\n  let isSorted = true;\n\n  // We go from right to left to avoid overriding the wrong elements\n  reversedIndicesToMove.forEach((index, i) => {\n    // We don't want to bubble the first elements that are sorted as they are\n    // already in their correct position\n    isSorted = isSorted && index === elements.length - i - 1;\n    if (isSorted) {\n      return;\n    }\n    swap(elements, index + 1, index);\n  });\n  return elements;\n}\n\n// Let's go through an example\n//        |        |\n// [a, b, c, d, e, f, g]\n// -->\n// [c, f, a, b, d, e, g]\n//\n// We are going to override all the elements we want to move, so we keep them in an array\n// that we will restore at the end.\n// [c, f]\n//\n// From now on, we'll never read those values from the array anymore\n//        |1       |0\n// [a, b, _, d, e, _, g]\n//\n// The idea is that we want to shift all the elements between the marker 0 and 1\n// by one slot to the right.\n//\n//        |1       |0\n// [a, b, _, d, e, _, g]\n//          -> ->\n//\n// which gives us\n//\n//        |1       |0\n// [a, b, _, _, d, e, g]\n//\n// Now, we need to move all the elements from marker 1 to the beginning by two (not one)\n// slots to the right, which gives us\n//\n//        |1       |0\n// [a, b, _, _, d, e, g]\n//  ---|--^  ^\n//     ------|\n//\n// which gives us\n//\n//        |1       |0\n// [_, _, a, b, d, e, g]\n//\n// At this point, we can fill back the leftmost elements with the array we saved at\n// the beggining\n//\n//        |1       |0\n// [c, f, a, b, d, e, g]\n//\n// And we are done!\nexport function moveAllLeft<T>(elements: T[], indicesToMove: number[]) {\n  indicesToMove.sort((a: number, b: number) => a - b);\n\n  // Copy the elements to move\n  const leftMostElements = indicesToMove.map(index => elements[index]);\n\n  const reversedIndicesToMove = indicesToMove\n    // We go from right to left to avoid overriding elements.\n    .reverse()\n    // We add 0 for the final marker\n    .concat([0]);\n\n  reversedIndicesToMove.forEach((index, i) => {\n    // We skip the first one as it is not paired with anything else\n    if (i === 0) {\n      return;\n    }\n\n    // We go from the next marker to the right (i - 1) to the current one (index)\n    for (let pos = reversedIndicesToMove[i - 1] - 1; pos >= index; --pos) {\n      // We move by 1 the first time, 2 the second... So we can use the index i in the array\n      elements[pos + i] = elements[pos];\n    }\n  });\n\n  // The final step\n  leftMostElements.forEach((element, i) => {\n    elements[i] = element;\n  });\n\n  return elements;\n}\n\n// Let's go through an example\n//        |        |\n// [a, b, c, d, e, f, g]\n// -->\n// [a, b, d, e, g, c, f]\n//\n// We are going to override all the elements we want to move, so we keep them in an array\n// that we will restore at the end.\n// [c, f]\n//\n// From now on, we'll never read those values from the array anymore\n//        |0       |1\n// [a, b, _, d, e, _, g]\n//\n// The idea is that we want to shift all the elements between the marker 0 and 1\n// by one slot to the left.\n//\n//        |0       |1\n// [a, b, _, d, e, _, g]\n//          <- <-\n//\n// which gives us\n//\n//        |0       |1\n// [a, b, d, e, _, _, g]\n//\n// Now, we need to move all the elements from marker 1 to the end by two (not one)\n// slots to the left, which gives us\n//\n//        |0       |1\n// [a, b, d, e, _, _, g]\n//              ^------\n//\n// which gives us\n//\n//        |0       |1\n// [a, b, d, e, g, _, _]\n//\n// At this point, we can fill back the rightmost elements with the array we saved at\n// the beggining\n//\n//        |0       |1\n// [a, b, d, e, g, c, f]\n//\n// And we are done!\nexport function moveAllRight<T>(elements: T[], indicesToMove: number[]) {\n  const reversedIndicesToMove = indicesToMove.sort(\n    (a: number, b: number) => b - a\n  );\n\n  // Copy the elements to move\n  const rightMostElements = reversedIndicesToMove.map(index => elements[index]);\n\n  indicesToMove = reversedIndicesToMove\n    // We go from left to right to avoid overriding elements.\n    .reverse()\n    // We last element index for the final marker\n    .concat([elements.length]);\n\n  indicesToMove.forEach((index, i) => {\n    // We skip the first one as it is not paired with anything else\n    if (i === 0) {\n      return;\n    }\n\n    // We go from the next marker to the left (i - 1) to the current one (index)\n    for (let pos = indicesToMove[i - 1] + 1; pos < index; ++pos) {\n      // We move by 1 the first time, 2 the second... So we can use the index i in the array\n      elements[pos - i] = elements[pos];\n    }\n  });\n\n  // The final step\n  rightMostElements.forEach((element, i) => {\n    elements[elements.length - i - 1] = element;\n  });\n\n  return elements;\n}\n","import { Action } from \"./types\";\nimport {\n  moveOneLeft,\n  moveOneRight,\n  moveAllLeft,\n  moveAllRight\n} from \"../zindex\";\nimport { getSelectedIndices } from \"../scene\";\nimport { META_KEY } from \"../keys\";\n\nexport const actionSendBackward: Action = {\n  name: \"sendBackward\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveOneLeft([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Send Backward\",\n  keyPriority: 40,\n  keyTest: event =>\n    event[META_KEY] && event.shiftKey && event.altKey && event.code === \"KeyB\"\n};\n\nexport const actionBringForward: Action = {\n  name: \"bringForward\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveOneRight([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Bring Forward\",\n  keyPriority: 40,\n  keyTest: event =>\n    event[META_KEY] && event.shiftKey && event.altKey && event.code === \"KeyF\"\n};\n\nexport const actionSendToBack: Action = {\n  name: \"sendToBack\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveAllLeft([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Send to Back\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyB\"\n};\n\nexport const actionBringToFront: Action = {\n  name: \"bringToFront\",\n  perform: (elements, appState) => {\n    return {\n      elements: moveAllRight([...elements], getSelectedIndices(elements)),\n      appState\n    };\n  },\n  contextItemLabel: \"Bring to Front\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyF\"\n};\n","import { Action } from \"./types\";\nimport { META_KEY } from \"../keys\";\n\nexport const actionSelectAll: Action = {\n  name: \"selectAll\",\n  perform: elements => {\n    return {\n      elements: elements.map(elem => ({ ...elem, isSelected: true }))\n    };\n  },\n  contextItemLabel: \"Select All\",\n  keyTest: event => event[META_KEY] && event.code === \"KeyA\"\n};\n","import React from \"react\";\n\nexport function ButtonSelect<T>({\n  options,\n  value,\n  onChange\n}: {\n  options: { value: T; text: string }[];\n  value: T | null;\n  onChange: (value: T) => void;\n}) {\n  return (\n    <div className=\"buttonList\">\n      {options.map(option => (\n        <button\n          key={option.text}\n          onClick={() => onChange(option.value)}\n          className={value === option.value ? \"active\" : \"\"}\n        >\n          {option.text}\n        </button>\n      ))}\n    </div>\n  );\n}\n","import React from \"react\";\nimport { Popover } from \"./Popover\";\n\nimport \"./ColorPicker.css\";\n\n// This is a narrow reimplementation of the awesome react-color Twitter component\n// https://github.com/casesandberg/react-color/blob/master/src/components/twitter/Twitter.js\n\nconst Picker = function({\n  colors,\n  color,\n  onChange\n}: {\n  colors: string[];\n  color: string | undefined;\n  onChange: (color: string) => void;\n}) {\n  const [innerValue, setInnerValue] = React.useState(color);\n  React.useEffect(() => {\n    setInnerValue(color);\n  }, [color]);\n  return (\n    <div className=\"color-picker\">\n      <div className=\"color-picker-triangle-shadow\"></div>\n      <div className=\"color-picker-triangle\"></div>\n      <div className=\"color-picker-content\">\n        {colors.map(color => (\n          <div\n            className=\"color-picker-swatch\"\n            onClick={() => {\n              onChange(color);\n            }}\n            title={color}\n            tabIndex={0}\n            style={{ backgroundColor: color }}\n            key={color}\n          >\n            {color === \"transparent\" ? (\n              <div className=\"color-picker-transparent\"></div>\n            ) : (\n              undefined\n            )}\n          </div>\n        ))}\n        <div className=\"color-picker-hash\">#</div>\n        <div style={{ position: \"relative\" }}>\n          <input\n            spellCheck={false}\n            className=\"color-picker-input\"\n            onChange={e => {\n              const value = e.target.value;\n              if (value.match(/^([0-9a-f]{3}|[0-9a-f]{6}|transparent)$/)) {\n                onChange(value === \"transparent\" ? \"transparent\" : \"#\" + value);\n              }\n              setInnerValue(value);\n            }}\n            value={(innerValue || \"\").replace(/^#/, \"\")}\n          />\n        </div>\n        <div style={{ clear: \"both\" }}></div>\n      </div>\n    </div>\n  );\n};\n\nexport function ColorPicker({\n  type,\n  color,\n  onChange\n}: {\n  type: \"canvasBackground\" | \"elementBackground\" | \"elementStroke\";\n  color: string | null;\n  onChange: (color: string) => void;\n}) {\n  const [isActive, setActive] = React.useState(false);\n  return (\n    <div>\n      <button\n        className=\"color-picker-label-swatch\"\n        style={color ? { backgroundColor: color } : undefined}\n        onClick={() => setActive(!isActive)}\n      />\n      <React.Suspense fallback=\"\">\n        {isActive ? (\n          <Popover onCloseRequest={() => setActive(false)}>\n            <Picker\n              colors={colors[type]}\n              color={color || undefined}\n              onChange={changedColor => {\n                onChange(changedColor);\n              }}\n            />\n          </Popover>\n        ) : null}\n      </React.Suspense>\n      <input\n        type=\"text\"\n        className=\"color-picker-swatch-input\"\n        value={color || \"\"}\n        onPaste={e => onChange(e.clipboardData.getData(\"text\"))}\n        onChange={e => onChange(e.target.value)}\n      />\n    </div>\n  );\n}\n\nconst colors = {\n  canvasBackground: [\n    \"#DEE6EF\",\n    \"#FCEAD8\",\n    \"#F9E0E0\",\n    \"#E6F1F1\",\n    \"#E0EDDF\",\n    \"#FBF5DD\",\n    \"#F0E6ED\",\n    \"#FFEDEF\",\n    \"#EDE5E1\",\n    \"#F2F0EF\",\n    \"#FFFFFF\"\n  ],\n  elementBackground: [\n    \"#4E79A7\",\n    \"#F28E2C\",\n    \"#E15759\",\n    \"#76B7B2\",\n    \"#59A14F\",\n    \"#EDC949\",\n    \"#AF7AA1\",\n    \"#FF9DA7\",\n    \"#9C755F\",\n    \"#BAB0AB\",\n    \"transparent\"\n  ],\n  elementStroke: [\n    \"#324E6B\",\n    \"#9B5B1D\",\n    \"#903839\",\n    \"#4C7572\",\n    \"#396733\",\n    \"#AD9336\",\n    \"#805976\",\n    \"#BA737A\",\n    \"#725646\",\n    \"#88817D\",\n    \"#000000\"\n  ]\n};\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport { ExcalidrawElement, ExcalidrawTextElement } from \"../element/types\";\nimport { getSelectedAttribute } from \"../scene\";\nimport { ButtonSelect } from \"../components/ButtonSelect\";\nimport { isTextElement, redrawTextBoundingBox } from \"../element\";\nimport { ColorPicker } from \"../components/ColorPicker\";\n\nconst changeProperty = (\n  elements: readonly ExcalidrawElement[],\n  callback: (element: ExcalidrawElement) => ExcalidrawElement\n) => {\n  return elements.map(element => {\n    if (element.isSelected) {\n      return callback(element);\n    }\n    return element;\n  });\n};\n\nexport const actionChangeStrokeColor: Action = {\n  name: \"changeStrokeColor\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        shape: null,\n        strokeColor: value\n      })),\n      appState: { ...appState, currentItemStrokeColor: value }\n    };\n  },\n  PanelComponent: ({ elements, appState, updateData }) => (\n    <>\n      <h5>Stroke</h5>\n      <ColorPicker\n        type=\"elementStroke\"\n        color={getSelectedAttribute(elements, element => element.strokeColor)}\n        onChange={updateData}\n      />\n    </>\n  )\n};\n\nexport const actionChangeBackgroundColor: Action = {\n  name: \"changeBackgroundColor\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        shape: null,\n        backgroundColor: value\n      })),\n      appState: { ...appState, currentItemBackgroundColor: value }\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Background</h5>\n      <ColorPicker\n        type=\"elementBackground\"\n        color={getSelectedAttribute(\n          elements,\n          element => element.backgroundColor\n        )}\n        onChange={updateData}\n      />\n    </>\n  )\n};\n\nexport const actionChangeFillStyle: Action = {\n  name: \"changeFillStyle\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        shape: null,\n        fillStyle: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Fill</h5>\n      <ButtonSelect\n        options={[\n          { value: \"solid\", text: \"Solid\" },\n          { value: \"hachure\", text: \"Hachure\" },\n          { value: \"cross-hatch\", text: \"Cross-hatch\" }\n        ]}\n        value={getSelectedAttribute(elements, element => element.fillStyle)}\n        onChange={value => {\n          updateData(value);\n        }}\n      />\n    </>\n  )\n};\n\nexport const actionChangeStrokeWidth: Action = {\n  name: \"changeStrokeWidth\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        shape: null,\n        strokeWidth: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, appState, updateData }) => (\n    <>\n      <h5>Stroke Width</h5>\n      <ButtonSelect\n        options={[\n          { value: 1, text: \"Thin\" },\n          { value: 2, text: \"Bold\" },\n          { value: 4, text: \"Extra Bold\" }\n        ]}\n        value={getSelectedAttribute(elements, element => element.strokeWidth)}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n\nexport const actionChangeSloppiness: Action = {\n  name: \"changeSloppiness\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        shape: null,\n        roughness: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, appState, updateData }) => (\n    <>\n      <h5>Sloppiness</h5>\n      <ButtonSelect\n        options={[\n          { value: 0, text: \"Draftsman\" },\n          { value: 1, text: \"Artist\" },\n          { value: 3, text: \"Cartoonist\" }\n        ]}\n        value={getSelectedAttribute(elements, element => element.roughness)}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n\nexport const actionChangeOpacity: Action = {\n  name: \"changeOpacity\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => ({\n        ...el,\n        shape: null,\n        opacity: value\n      }))\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Opacity</h5>\n      <input\n        type=\"range\"\n        min=\"0\"\n        max=\"100\"\n        onChange={e => updateData(+e.target.value)}\n        value={\n          getSelectedAttribute(elements, element => element.opacity) ||\n          0 /* Put the opacity at 0 if there are two conflicting ones */\n        }\n      />\n    </>\n  )\n};\n\nexport const actionChangeFontSize: Action = {\n  name: \"changeFontSize\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => {\n        if (isTextElement(el)) {\n          const element: ExcalidrawTextElement = {\n            ...el,\n            shape: null,\n            font: `${value}px ${el.font.split(\"px \")[1]}`\n          };\n          redrawTextBoundingBox(element);\n          return element;\n        }\n\n        return el;\n      })\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Font size</h5>\n      <ButtonSelect\n        options={[\n          { value: 16, text: \"Small\" },\n          { value: 20, text: \"Medium\" },\n          { value: 28, text: \"Large\" },\n          { value: 36, text: \"Very Large\" }\n        ]}\n        value={getSelectedAttribute(\n          elements,\n          element => isTextElement(element) && +element.font.split(\"px \")[0]\n        )}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n\nexport const actionChangeFontFamily: Action = {\n  name: \"changeFontFamily\",\n  perform: (elements, appState, value) => {\n    return {\n      elements: changeProperty(elements, el => {\n        if (isTextElement(el)) {\n          const element: ExcalidrawTextElement = {\n            ...el,\n            shape: null,\n            font: `${el.font.split(\"px \")[0]}px ${value}`\n          };\n          redrawTextBoundingBox(element);\n          return element;\n        }\n\n        return el;\n      })\n    };\n  },\n  PanelComponent: ({ elements, updateData }) => (\n    <>\n      <h5>Font family</h5>\n      <ButtonSelect\n        options={[\n          { value: \"Virgil\", text: \"Virgil\" },\n          { value: \"Helvetica\", text: \"Helvetica\" },\n          { value: \"Courier\", text: \"Courier\" }\n        ]}\n        value={getSelectedAttribute(\n          elements,\n          element => isTextElement(element) && element.font.split(\"px \")[1]\n        )}\n        onChange={value => updateData(value)}\n      />\n    </>\n  )\n};\n","//\n// All icons are imported from https://fontawesome.com/icons?d=gallery\n// Icons are under the license https://fontawesome.com/license\n//\n\nimport React from \"react\";\n\nexport const save = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 448 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z\"\n    />\n  </svg>\n);\n\nexport const load = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 576 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z\"\n    />\n  </svg>\n);\n\nexport const image = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 384 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M384 121.941V128H256V0h6.059a24 24 0 0 1 16.97 7.029l97.941 97.941a24.002 24.002 0 0 1 7.03 16.971zM248 160c-13.2 0-24-10.8-24-24V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248zm-135.455 16c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.491-48 48-48zm208 240h-256l.485-48.485L104.545 328c4.686-4.686 11.799-4.201 16.485.485L160.545 368 264.06 264.485c4.686-4.686 12.284-4.686 16.971 0L320.545 304v112z\"\n    />\n  </svg>\n);\n\nexport const clipboard = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 384 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M384 112v352c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h80c0-35.29 28.71-64 64-64s64 28.71 64 64h80c26.51 0 48 21.49 48 48zM192 40c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24m96 114v-20a6 6 0 0 0-6-6H102a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h180a6 6 0 0 0 6-6z\"\n    />\n  </svg>\n);\n\nexport const trash = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 448 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z\"\n    />\n  </svg>\n);\n\nexport const palete = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 512 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z\"\n    />\n  </svg>\n);\n\nexport const exportFile = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 576 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M384 121.9c0-6.3-2.5-12.4-7-16.9L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128zM571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-379 28v-32c0-8.8 7.2-16 16-16h176V160H248c-13.2 0-24-10.8-24-24V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V352H208c-8.8 0-16-7.2-16-16z\"\n    />\n  </svg>\n);\n\nexport const downloadFile = (\n  <svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox=\"0 0 384 512\">\n    <path\n      fill=\"currentColor\"\n      d=\"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z\"\n    />\n  </svg>\n);\n","import \"./ToolIcon.scss\";\n\nimport React from \"react\";\n\ntype ToolIconProps =\n  | {\n      type: \"button\";\n      icon: React.ReactNode;\n      \"aria-label\": string;\n      title?: string;\n      name?: string;\n      id?: string;\n      onClick?(): void;\n    }\n  | {\n      type: \"radio\";\n      icon: React.ReactNode;\n      title?: string;\n      name?: string;\n      id?: string;\n      checked: boolean;\n      onChange?(): void;\n    };\n\nexport function ToolIcon(props: ToolIconProps) {\n  if (props.type === \"button\")\n    return (\n      <label className=\"ToolIcon\" title={props.title}>\n        <button\n          className=\"ToolIcon_type_button\"\n          aria-label={props[\"aria-label\"]}\n          type=\"button\"\n          onClick={props.onClick}\n        >\n          <div className=\"ToolIcon__icon\">{props.icon}</div>\n        </button>\n      </label>\n    );\n\n  return (\n    <label className=\"ToolIcon\" title={props.title}>\n      <input\n        className=\"ToolIcon_type_radio\"\n        type=\"radio\"\n        name={props.name}\n        id={props.id}\n        onChange={props.onChange}\n        checked={props.checked}\n      />\n      <div className=\"ToolIcon__icon\">{props.icon}</div>\n    </label>\n  );\n}\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport { ColorPicker } from \"../components/ColorPicker\";\nimport { getDefaultAppState } from \"../appState\";\nimport { trash } from \"../components/icons\";\nimport { ToolIcon } from \"../components/ToolIcon\";\n\nexport const actionChangeViewBackgroundColor: Action = {\n  name: \"changeViewBackgroundColor\",\n  perform: (elements, appState, value) => {\n    return { appState: { ...appState, viewBackgroundColor: value } };\n  },\n  PanelComponent: ({ appState, updateData }) => {\n    return (\n      <div style={{ position: \"relative\" }}>\n        <ColorPicker\n          type=\"canvasBackground\"\n          color={appState.viewBackgroundColor}\n          onChange={color => updateData(color)}\n        />\n      </div>\n    );\n  }\n};\n\nexport const actionClearCanvas: Action = {\n  name: \"clearCanvas\",\n  perform: () => {\n    return {\n      elements: [],\n      appState: getDefaultAppState()\n    };\n  },\n  PanelComponent: ({ updateData }) => (\n    <ToolIcon\n      type=\"button\"\n      icon={trash}\n      title=\"Clear the canvas & reset background color\"\n      aria-label=\"Clear the canvas & reset background color\"\n      onClick={() => {\n        if (window.confirm(\"This will clear the whole canvas. Are you sure?\")) {\n          updateData(null);\n        }\n      }}\n    />\n  )\n};\n","import \"./EditableText.css\";\n\nimport React, { Component } from \"react\";\nimport { selectNode, removeSelection } from \"../utils\";\n\ntype Props = {\n  value: string;\n  onChange: (value: string) => void;\n};\n\nexport class EditableText extends Component<Props> {\n  private handleFocus = (e: React.FocusEvent<HTMLElement>) => {\n    selectNode(e.currentTarget);\n  };\n\n  private handleBlur = (e: React.FocusEvent<HTMLElement>) => {\n    const value = e.currentTarget.innerText.trim();\n    if (value !== this.props.value) this.props.onChange(value);\n    removeSelection();\n  };\n\n  private handleKeyDown = (e: React.KeyboardEvent<HTMLElement>) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault();\n      e.currentTarget.blur();\n    }\n  };\n\n  public render() {\n    return (\n      <span\n        suppressContentEditableWarning\n        contentEditable=\"true\"\n        data-type=\"wysiwyg\"\n        className=\"project-name\"\n        onBlur={this.handleBlur}\n        onKeyDown={this.handleKeyDown}\n        onFocus={this.handleFocus}\n      >\n        {this.props.value}\n      </span>\n    );\n  }\n}\n","import React from \"react\";\nimport { Action } from \"./types\";\nimport { EditableText } from \"../components/EditableText\";\nimport { saveAsJSON, loadFromJSON } from \"../scene\";\nimport { load, save } from \"../components/icons\";\nimport { ToolIcon } from \"../components/ToolIcon\";\n\nexport const actionChangeProjectName: Action = {\n  name: \"changeProjectName\",\n  perform: (elements, appState, value) => {\n    return { appState: { ...appState, name: value } };\n  },\n  PanelComponent: ({ appState, updateData }) => (\n    <EditableText\n      value={appState.name || \"Unnamed\"}\n      onChange={(name: string) => updateData(name)}\n    />\n  )\n};\n\nexport const actionChangeExportBackground: Action = {\n  name: \"changeExportBackground\",\n  perform: (elements, appState, value) => {\n    return { appState: { ...appState, exportBackground: value } };\n  },\n  PanelComponent: ({ appState, updateData }) => (\n    <label>\n      <input\n        type=\"checkbox\"\n        checked={appState.exportBackground}\n        onChange={e => {\n          updateData(e.target.checked);\n        }}\n      />{\" \"}\n      With background\n    </label>\n  )\n};\n\nexport const actionSaveScene: Action = {\n  name: \"saveScene\",\n  perform: (elements, appState, value) => {\n    saveAsJSON(elements, appState);\n    return {};\n  },\n  PanelComponent: ({ updateData }) => (\n    <ToolIcon\n      type=\"button\"\n      icon={save}\n      title=\"Save\"\n      aria-label=\"Save\"\n      onClick={() => updateData(null)}\n    />\n  )\n};\n\nexport const actionLoadScene: Action = {\n  name: \"loadScene\",\n  perform: (\n    elements,\n    appState,\n    { elements: loadedElements, appState: loadedAppState }\n  ) => {\n    return { elements: loadedElements, appState: loadedAppState };\n  },\n  PanelComponent: ({ updateData }) => (\n    <ToolIcon\n      type=\"button\"\n      icon={load}\n      title=\"Load\"\n      aria-label=\"Load\"\n      onClick={() => {\n        loadFromJSON().then(({ elements, appState }) => {\n          updateData({ elements: elements, appState: appState });\n        });\n      }}\n    />\n  )\n};\n","import { Action } from \"./types\";\nimport { isTextElement, redrawTextBoundingBox } from \"../element\";\nimport { META_KEY } from \"../keys\";\n\nlet copiedStyles: string = \"{}\";\n\nexport const actionCopyStyles: Action = {\n  name: \"copyStyles\",\n  perform: elements => {\n    const element = elements.find(el => el.isSelected);\n    if (element) {\n      copiedStyles = JSON.stringify(element);\n    }\n    return {};\n  },\n  contextItemLabel: \"Copy Styles\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyC\",\n  contextMenuOrder: 0\n};\n\nexport const actionPasteStyles: Action = {\n  name: \"pasteStyles\",\n  perform: elements => {\n    const pastedElement = JSON.parse(copiedStyles);\n    return {\n      elements: elements.map(element => {\n        if (element.isSelected) {\n          const newElement = {\n            ...element,\n            shape: null,\n            backgroundColor: pastedElement?.backgroundColor,\n            strokeWidth: pastedElement?.strokeWidth,\n            strokeColor: pastedElement?.strokeColor,\n            fillStyle: pastedElement?.fillStyle,\n            opacity: pastedElement?.opacity,\n            roughness: pastedElement?.roughness\n          };\n          if (isTextElement(newElement)) {\n            newElement.font = pastedElement?.font;\n            redrawTextBoundingBox(newElement);\n          }\n          return newElement;\n        }\n        return element;\n      })\n    };\n  },\n  contextItemLabel: \"Paste Styles\",\n  keyTest: event => event[META_KEY] && event.shiftKey && event.code === \"KeyV\",\n  contextMenuOrder: 1\n};\n","import \"./Island.css\";\n\nimport React from \"react\";\n\ntype IslandProps = { children: React.ReactNode; padding?: number };\n\nexport function Island({ children, padding }: IslandProps) {\n  return (\n    <div\n      className=\"Island\"\n      style={{ \"--padding\": padding } as React.CSSProperties}\n    >\n      {children}\n    </div>\n  );\n}\n","import \"./Stack.css\";\n\nimport React from \"react\";\n\ntype StackProps = {\n  children: React.ReactNode;\n  gap?: number;\n  align?: \"start\" | \"center\" | \"end\";\n};\n\nfunction RowStack({ children, gap, align }: StackProps) {\n  return (\n    <div\n      className=\"Stack Stack_horizontal\"\n      style={{ \"--gap\": gap, alignItems: align } as React.CSSProperties}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction ColStack({ children, gap, align }: StackProps) {\n  return (\n    <div\n      className=\"Stack Stack_vertical\"\n      style={{ \"--gap\": gap, justifyItems: align } as React.CSSProperties}\n    >\n      {children}\n    </div>\n  );\n}\n\nexport default {\n  Row: RowStack,\n  Col: ColStack\n};\n","import \"./FixedSideContainer.css\";\n\nimport React from \"react\";\n\ntype FixedSideContainerProps = {\n  children: React.ReactNode;\n  side: \"top\" | \"left\" | \"right\";\n};\n\nexport function FixedSideContainer({\n  children,\n  side\n}: FixedSideContainerProps) {\n  return (\n    <div className={\"FixedSideContainer FixedSideContainer_side_\" + side}>\n      {children}\n    </div>\n  );\n}\n","import \"./Modal.css\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\n\nexport function Modal(props: {\n  children: React.ReactNode;\n  maxWidth?: number;\n  onCloseRequest(): void;\n}) {\n  const modalRoot = useBodyRoot();\n  return createPortal(\n    <div className=\"Modal\">\n      <div className=\"Modal__background\" onClick={props.onCloseRequest}></div>\n      <div className=\"Modal__content\" style={{ maxWidth: props.maxWidth }}>\n        {props.children}\n      </div>\n    </div>,\n    modalRoot\n  );\n}\n\nfunction useBodyRoot() {\n  function createDiv() {\n    const div = document.createElement(\"div\");\n    document.body.appendChild(div);\n    return div;\n  }\n  const [div] = useState(createDiv);\n  useEffect(() => {\n    return () => {\n      document.body.removeChild(div);\n    };\n  }, [div]);\n  return div;\n}\n","import \"./ExportDialog.css\";\n\nimport React, { useState, useEffect, useRef } from \"react\";\n\nimport { Modal } from \"./Modal\";\nimport { ToolIcon } from \"./ToolIcon\";\nimport { clipboard, exportFile, downloadFile } from \"./icons\";\nimport { Island } from \"./Island\";\nimport { ExcalidrawElement } from \"../element/types\";\nimport { AppState } from \"../types\";\nimport { getExportCanvasPreview } from \"../scene/data\";\nimport { ActionsManagerInterface, UpdaterFn } from \"../actions/types\";\nimport Stack from \"./Stack\";\n\nconst probablySupportsClipboard =\n  \"toBlob\" in HTMLCanvasElement.prototype &&\n  \"clipboard\" in navigator &&\n  \"write\" in navigator.clipboard &&\n  \"ClipboardItem\" in window;\n\nexport function ExportDialog({\n  elements,\n  appState,\n  exportPadding = 10,\n  actionManager,\n  syncActionResult,\n  onExportToPng,\n  onExportToClipboard\n}: {\n  appState: AppState;\n  elements: readonly ExcalidrawElement[];\n  exportPadding?: number;\n  actionManager: ActionsManagerInterface;\n  syncActionResult: UpdaterFn;\n  onExportToPng(elements: readonly ExcalidrawElement[]): void;\n  onExportToClipboard(elements: readonly ExcalidrawElement[]): void;\n}) {\n  const someElementIsSelected = elements.some(element => element.isSelected);\n  const [modalIsShown, setModalIsShown] = useState(false);\n  const [exportSelected, setExportSelected] = useState(someElementIsSelected);\n  const previeRef = useRef<HTMLDivElement>(null);\n  const { exportBackground, viewBackgroundColor } = appState;\n\n  const exportedElements = exportSelected\n    ? elements.filter(element => element.isSelected)\n    : elements;\n\n  useEffect(() => {\n    setExportSelected(someElementIsSelected);\n  }, [someElementIsSelected]);\n\n  useEffect(() => {\n    const previewNode = previeRef.current;\n    const canvas = getExportCanvasPreview(exportedElements, {\n      exportBackground,\n      viewBackgroundColor,\n      exportPadding\n    });\n    previewNode?.appendChild(canvas);\n    return () => {\n      previewNode?.removeChild(canvas);\n    };\n  }, [\n    modalIsShown,\n    exportedElements,\n    exportBackground,\n    exportPadding,\n    viewBackgroundColor\n  ]);\n\n  function handleClose() {\n    setModalIsShown(false);\n    setExportSelected(someElementIsSelected);\n  }\n\n  return (\n    <>\n      <ToolIcon\n        onClick={() => setModalIsShown(true)}\n        icon={exportFile}\n        type=\"button\"\n        aria-label=\"Show export dialog\"\n        title=\"Export\"\n      />\n      {modalIsShown && (\n        <Modal maxWidth={640} onCloseRequest={handleClose}>\n          <div className=\"ExportDialog__dialog\">\n            <Island padding={4}>\n              <button className=\"ExportDialog__close\" onClick={handleClose}>\n                \n              </button>\n              <h2>Export</h2>\n              <div className=\"ExportDialog__preview\" ref={previeRef}></div>\n              <div className=\"ExportDialog__actions\">\n                <Stack.Row gap={2}>\n                  <ToolIcon\n                    type=\"button\"\n                    icon={downloadFile}\n                    title=\"Export to PNG\"\n                    aria-label=\"Export to PNG\"\n                    onClick={() => onExportToPng(exportedElements)}\n                  />\n\n                  {probablySupportsClipboard && (\n                    <ToolIcon\n                      type=\"button\"\n                      icon={clipboard}\n                      title=\"Copy to clipboard\"\n                      aria-label=\"Copy to clipboard\"\n                      onClick={() => onExportToClipboard(exportedElements)}\n                    />\n                  )}\n                </Stack.Row>\n\n                {actionManager.renderAction(\n                  \"changeProjectName\",\n                  elements,\n                  appState,\n                  syncActionResult\n                )}\n                <Stack.Col gap={1}>\n                  {actionManager.renderAction(\n                    \"changeExportBackground\",\n                    elements,\n                    appState,\n                    syncActionResult\n                  )}\n                  {someElementIsSelected && (\n                    <div>\n                      <label>\n                        <input\n                          type=\"checkbox\"\n                          checked={exportSelected}\n                          onChange={e =>\n                            setExportSelected(e.currentTarget.checked)\n                          }\n                        />{\" \"}\n                        Only selected\n                      </label>\n                    </div>\n                  )}\n                </Stack.Col>\n              </div>\n            </Island>\n          </div>\n        </Modal>\n      )}\n    </>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport rough from \"roughjs/bin/rough\";\nimport { RoughCanvas } from \"roughjs/bin/canvas\";\n\nimport {\n  newElement,\n  duplicateElement,\n  resizeTest,\n  isTextElement,\n  textWysiwyg,\n  getElementAbsoluteCoords\n} from \"./element\";\nimport {\n  clearSelection,\n  deleteSelectedElements,\n  getElementsWithinSelection,\n  isOverScrollBars,\n  restoreFromLocalStorage,\n  saveToLocalStorage,\n  getElementAtPosition,\n  createScene,\n  getElementContainingPosition,\n  hasBackground,\n  hasStroke,\n  hasText,\n  exportCanvas\n} from \"./scene\";\n\nimport { renderScene } from \"./renderer\";\nimport { AppState } from \"./types\";\nimport { ExcalidrawElement, ExcalidrawTextElement } from \"./element/types\";\n\nimport { isInputLike, measureText, debounce, capitalizeString } from \"./utils\";\nimport { KEYS, META_KEY, isArrowKey } from \"./keys\";\n\nimport { findShapeByKey, shapesShortcutKeys, SHAPES } from \"./shapes\";\nimport { createHistory } from \"./history\";\n\nimport ContextMenu from \"./components/ContextMenu\";\n\nimport \"./styles.scss\";\nimport { getElementWithResizeHandler } from \"./element/resizeTest\";\nimport {\n  ActionManager,\n  actionDeleteSelected,\n  actionSendBackward,\n  actionBringForward,\n  actionSendToBack,\n  actionBringToFront,\n  actionSelectAll,\n  actionChangeStrokeColor,\n  actionChangeBackgroundColor,\n  actionChangeOpacity,\n  actionChangeStrokeWidth,\n  actionChangeFillStyle,\n  actionChangeSloppiness,\n  actionChangeFontSize,\n  actionChangeFontFamily,\n  actionChangeViewBackgroundColor,\n  actionClearCanvas,\n  actionChangeProjectName,\n  actionChangeExportBackground,\n  actionLoadScene,\n  actionSaveScene,\n  actionCopyStyles,\n  actionPasteStyles\n} from \"./actions\";\nimport { Action, ActionResult } from \"./actions/types\";\nimport { getDefaultAppState } from \"./appState\";\nimport { Island } from \"./components/Island\";\nimport Stack from \"./components/Stack\";\nimport { FixedSideContainer } from \"./components/FixedSideContainer\";\nimport { ToolIcon } from \"./components/ToolIcon\";\nimport { ExportDialog } from \"./components/ExportDialog\";\n\nlet { elements } = createScene();\nconst { history } = createHistory();\n\nconst CANVAS_WINDOW_OFFSET_LEFT = 0;\nconst CANVAS_WINDOW_OFFSET_TOP = 0;\n\nfunction resetCursor() {\n  document.documentElement.style.cursor = \"\";\n}\n\nfunction addTextElement(\n  element: ExcalidrawTextElement,\n  text: string,\n  font: string\n) {\n  resetCursor();\n  if (text === null || text === \"\") {\n    return false;\n  }\n\n  const metrics = measureText(text, font);\n  element.text = text;\n  element.font = font;\n  // Center the text\n  element.x -= metrics.width / 2;\n  element.y -= metrics.height / 2;\n  element.width = metrics.width;\n  element.height = metrics.height;\n  element.baseline = metrics.baseline;\n\n  return true;\n}\n\nconst ELEMENT_SHIFT_TRANSLATE_AMOUNT = 5;\nconst ELEMENT_TRANSLATE_AMOUNT = 1;\nconst TEXT_TO_CENTER_SNAP_THRESHOLD = 30;\n\nlet lastCanvasWidth = -1;\nlet lastCanvasHeight = -1;\n\nlet lastMouseUp: ((e: any) => void) | null = null;\n\nexport function viewportCoordsToSceneCoords(\n  { clientX, clientY }: { clientX: number; clientY: number },\n  { scrollX, scrollY }: { scrollX: number; scrollY: number }\n) {\n  const x = clientX - CANVAS_WINDOW_OFFSET_LEFT - scrollX;\n  const y = clientY - CANVAS_WINDOW_OFFSET_TOP - scrollY;\n  return { x, y };\n}\n\nexport class App extends React.Component<{}, AppState> {\n  canvas: HTMLCanvasElement | null = null;\n  rc: RoughCanvas | null = null;\n\n  actionManager: ActionManager = new ActionManager();\n  canvasOnlyActions: Array<Action>;\n  constructor(props: any) {\n    super(props);\n    this.actionManager.registerAction(actionDeleteSelected);\n    this.actionManager.registerAction(actionSendToBack);\n    this.actionManager.registerAction(actionBringToFront);\n    this.actionManager.registerAction(actionSendBackward);\n    this.actionManager.registerAction(actionBringForward);\n    this.actionManager.registerAction(actionSelectAll);\n\n    this.actionManager.registerAction(actionChangeStrokeColor);\n    this.actionManager.registerAction(actionChangeBackgroundColor);\n    this.actionManager.registerAction(actionChangeFillStyle);\n    this.actionManager.registerAction(actionChangeStrokeWidth);\n    this.actionManager.registerAction(actionChangeOpacity);\n    this.actionManager.registerAction(actionChangeSloppiness);\n    this.actionManager.registerAction(actionChangeFontSize);\n    this.actionManager.registerAction(actionChangeFontFamily);\n\n    this.actionManager.registerAction(actionChangeViewBackgroundColor);\n    this.actionManager.registerAction(actionClearCanvas);\n\n    this.actionManager.registerAction(actionChangeProjectName);\n    this.actionManager.registerAction(actionChangeExportBackground);\n    this.actionManager.registerAction(actionSaveScene);\n    this.actionManager.registerAction(actionLoadScene);\n\n    this.actionManager.registerAction(actionCopyStyles);\n    this.actionManager.registerAction(actionPasteStyles);\n\n    this.canvasOnlyActions = [actionSelectAll];\n  }\n\n  private syncActionResult = (res: ActionResult) => {\n    if (res.elements !== undefined) {\n      elements = res.elements;\n      this.forceUpdate();\n    }\n\n    if (res.appState !== undefined) {\n      this.setState({ ...res.appState });\n    }\n  };\n\n  private onCut = (e: ClipboardEvent) => {\n    if (isInputLike(e.target)) return;\n    e.clipboardData?.setData(\n      \"text/plain\",\n      JSON.stringify(\n        elements\n          .filter(element => element.isSelected)\n          .map(({ shape, ...el }) => el)\n      )\n    );\n    elements = deleteSelectedElements(elements);\n    this.forceUpdate();\n    e.preventDefault();\n  };\n  private onCopy = (e: ClipboardEvent) => {\n    if (isInputLike(e.target)) return;\n    e.clipboardData?.setData(\n      \"text/plain\",\n      JSON.stringify(\n        elements\n          .filter(element => element.isSelected)\n          .map(({ shape, ...el }) => el)\n      )\n    );\n    e.preventDefault();\n  };\n  private onPaste = (e: ClipboardEvent) => {\n    if (isInputLike(e.target)) return;\n    const paste = e.clipboardData?.getData(\"text\") || \"\";\n    this.addElementsFromPaste(paste);\n    e.preventDefault();\n  };\n\n  public componentDidMount() {\n    document.addEventListener(\"copy\", this.onCopy);\n    document.addEventListener(\"paste\", this.onPaste);\n    document.addEventListener(\"cut\", this.onCut);\n\n    document.addEventListener(\"keydown\", this.onKeyDown, false);\n    document.addEventListener(\"mousemove\", this.getCurrentCursorPosition);\n    window.addEventListener(\"resize\", this.onResize, false);\n\n    const { elements: newElements, appState } = restoreFromLocalStorage();\n\n    if (newElements) {\n      elements = newElements;\n    }\n\n    if (appState) {\n      this.setState(appState);\n    } else {\n      this.forceUpdate();\n    }\n  }\n\n  public componentWillUnmount() {\n    document.removeEventListener(\"copy\", this.onCopy);\n    document.removeEventListener(\"paste\", this.onPaste);\n    document.removeEventListener(\"cut\", this.onCut);\n\n    document.removeEventListener(\"keydown\", this.onKeyDown, false);\n    document.removeEventListener(\n      \"mousemove\",\n      this.getCurrentCursorPosition,\n      false\n    );\n    window.removeEventListener(\"resize\", this.onResize, false);\n  }\n\n  public state: AppState = getDefaultAppState();\n\n  private onResize = () => {\n    this.forceUpdate();\n  };\n\n  private getCurrentCursorPosition = (e: MouseEvent) => {\n    this.setState({ cursorX: e.x, cursorY: e.y });\n  };\n\n  private onKeyDown = (event: KeyboardEvent) => {\n    if (event.key === KEYS.ESCAPE) {\n      elements = clearSelection(elements);\n      this.forceUpdate();\n      this.setState({ elementType: \"selection\" });\n      if (window.document.activeElement instanceof HTMLElement) {\n        window.document.activeElement.blur();\n      }\n      event.preventDefault();\n      return;\n    }\n    if (isInputLike(event.target)) return;\n\n    const data = this.actionManager.handleKeyDown(event, elements, this.state);\n    this.syncActionResult(data);\n\n    if (data.elements !== undefined || data.appState !== undefined) {\n      return;\n    }\n\n    if (isArrowKey(event.key)) {\n      const step = event.shiftKey\n        ? ELEMENT_SHIFT_TRANSLATE_AMOUNT\n        : ELEMENT_TRANSLATE_AMOUNT;\n      elements = elements.map(el => {\n        if (el.isSelected) {\n          const element = { ...el };\n          if (event.key === KEYS.ARROW_LEFT) element.x -= step;\n          else if (event.key === KEYS.ARROW_RIGHT) element.x += step;\n          else if (event.key === KEYS.ARROW_UP) element.y -= step;\n          else if (event.key === KEYS.ARROW_DOWN) element.y += step;\n          return element;\n        }\n        return el;\n      });\n      this.forceUpdate();\n      event.preventDefault();\n    } else if (\n      shapesShortcutKeys.includes(event.key.toLowerCase()) &&\n      !event.ctrlKey &&\n      !event.shiftKey &&\n      !event.altKey &&\n      !event.metaKey\n    ) {\n      this.setState({ elementType: findShapeByKey(event.key) });\n    } else if (event[META_KEY] && event.code === \"KeyZ\") {\n      if (event.shiftKey) {\n        // Redo action\n        const data = history.redoOnce();\n        if (data !== null) {\n          elements = data;\n        }\n      } else {\n        // undo action\n        const data = history.undoOnce();\n        if (data !== null) {\n          elements = data;\n        }\n      }\n      this.forceUpdate();\n      event.preventDefault();\n    }\n  };\n\n  private removeWheelEventListener: (() => void) | undefined;\n\n  private copyToClipboard = () => {\n    if (navigator.clipboard) {\n      const text = JSON.stringify(\n        elements\n          .filter(element => element.isSelected)\n          .map(({ shape, ...el }) => el)\n      );\n      navigator.clipboard.writeText(text);\n    }\n  };\n\n  private pasteFromClipboard = () => {\n    if (navigator.clipboard) {\n      navigator.clipboard\n        .readText()\n        .then(text => this.addElementsFromPaste(text));\n    }\n  };\n\n  private renderSelectedShapeActions(elements: readonly ExcalidrawElement[]) {\n    const selectedElements = elements.filter(el => el.isSelected);\n    if (selectedElements.length === 0) {\n      return null;\n    }\n\n    return (\n      <Island padding={4}>\n        <div className=\"panelColumn\">\n          {this.actionManager.renderAction(\n            \"changeStrokeColor\",\n            elements,\n            this.state,\n            this.syncActionResult\n          )}\n\n          {hasBackground(elements) && (\n            <>\n              {this.actionManager.renderAction(\n                \"changeBackgroundColor\",\n                elements,\n                this.state,\n                this.syncActionResult\n              )}\n\n              {this.actionManager.renderAction(\n                \"changeFillStyle\",\n                elements,\n                this.state,\n                this.syncActionResult\n              )}\n              <hr />\n            </>\n          )}\n\n          {hasStroke(elements) && (\n            <>\n              {this.actionManager.renderAction(\n                \"changeStrokeWidth\",\n                elements,\n                this.state,\n                this.syncActionResult\n              )}\n\n              {this.actionManager.renderAction(\n                \"changeSloppiness\",\n                elements,\n                this.state,\n                this.syncActionResult\n              )}\n              <hr />\n            </>\n          )}\n\n          {hasText(elements) && (\n            <>\n              {this.actionManager.renderAction(\n                \"changeFontSize\",\n                elements,\n                this.state,\n                this.syncActionResult\n              )}\n\n              {this.actionManager.renderAction(\n                \"changeFontFamily\",\n                elements,\n                this.state,\n                this.syncActionResult\n              )}\n              <hr />\n            </>\n          )}\n\n          {this.actionManager.renderAction(\n            \"changeOpacity\",\n            elements,\n            this.state,\n            this.syncActionResult\n          )}\n\n          {this.actionManager.renderAction(\n            \"deleteSelectedElements\",\n            elements,\n            this.state,\n            this.syncActionResult\n          )}\n        </div>\n      </Island>\n    );\n  }\n\n  private renderShapesSwitcher() {\n    return (\n      <>\n        {SHAPES.map(({ value, icon }) => (\n          <ToolIcon\n            key={value}\n            type=\"radio\"\n            icon={icon}\n            checked={this.state.elementType === value}\n            name=\"editor-current-shape\"\n            title={`${capitalizeString(value)}  ${capitalizeString(value)[0]}`}\n            onChange={() => {\n              this.setState({ elementType: value });\n              elements = clearSelection(elements);\n              document.documentElement.style.cursor =\n                value === \"text\" ? \"text\" : \"crosshair\";\n              this.forceUpdate();\n            }}\n          ></ToolIcon>\n        ))}\n      </>\n    );\n  }\n\n  private renderCanvasActions() {\n    return (\n      <Stack.Col gap={4}>\n        <Stack.Row gap={1}>\n          {this.actionManager.renderAction(\n            \"loadScene\",\n            elements,\n            this.state,\n            this.syncActionResult\n          )}\n          {this.actionManager.renderAction(\n            \"saveScene\",\n            elements,\n            this.state,\n            this.syncActionResult\n          )}\n          <ExportDialog\n            elements={elements}\n            appState={this.state}\n            actionManager={this.actionManager}\n            syncActionResult={this.syncActionResult}\n            onExportToPng={exportedElements => {\n              if (this.canvas)\n                exportCanvas(\"png\", exportedElements, this.canvas, this.state);\n            }}\n            onExportToClipboard={exportedElements => {\n              if (this.canvas)\n                exportCanvas(\n                  \"clipboard\",\n                  exportedElements,\n                  this.canvas,\n                  this.state\n                );\n            }}\n          />\n          {this.actionManager.renderAction(\n            \"clearCanvas\",\n            elements,\n            this.state,\n            this.syncActionResult\n          )}\n        </Stack.Row>\n        {this.actionManager.renderAction(\n          \"changeViewBackgroundColor\",\n          elements,\n          this.state,\n          this.syncActionResult\n        )}\n      </Stack.Col>\n    );\n  }\n\n  public render() {\n    const canvasWidth = window.innerWidth - CANVAS_WINDOW_OFFSET_LEFT;\n    const canvasHeight = window.innerHeight - CANVAS_WINDOW_OFFSET_TOP;\n\n    return (\n      <div className=\"container\">\n        <FixedSideContainer side=\"top\">\n          <div className=\"App-menu App-menu_top\">\n            <Stack.Col gap={4} align=\"end\">\n              <div className=\"App-right-menu\">\n                <Island padding={4}>{this.renderCanvasActions()}</Island>\n              </div>\n              <div className=\"App-right-menu\">\n                {this.renderSelectedShapeActions(elements)}\n              </div>\n            </Stack.Col>\n            <Stack.Col gap={4} align=\"start\">\n              <Island padding={1}>\n                <Stack.Row gap={1}>{this.renderShapesSwitcher()}</Stack.Row>\n              </Island>\n            </Stack.Col>\n            <div />\n          </div>\n        </FixedSideContainer>\n        <canvas\n          id=\"canvas\"\n          style={{\n            width: canvasWidth,\n            height: canvasHeight\n          }}\n          width={canvasWidth * window.devicePixelRatio}\n          height={canvasHeight * window.devicePixelRatio}\n          ref={canvas => {\n            if (this.canvas === null) {\n              this.canvas = canvas;\n              this.rc = rough.canvas(this.canvas!);\n            }\n            if (this.removeWheelEventListener) {\n              this.removeWheelEventListener();\n              this.removeWheelEventListener = undefined;\n            }\n            if (canvas) {\n              canvas.addEventListener(\"wheel\", this.handleWheel, {\n                passive: false\n              });\n              this.removeWheelEventListener = () =>\n                canvas.removeEventListener(\"wheel\", this.handleWheel);\n              // Whenever React sets the width/height of the canvas element,\n              // the context loses the scale transform. We need to re-apply it\n              if (\n                canvasWidth !== lastCanvasWidth ||\n                canvasHeight !== lastCanvasHeight\n              ) {\n                lastCanvasWidth = canvasWidth;\n                lastCanvasHeight = canvasHeight;\n                canvas\n                  .getContext(\"2d\")!\n                  .scale(window.devicePixelRatio, window.devicePixelRatio);\n              }\n            }\n          }}\n          onContextMenu={e => {\n            e.preventDefault();\n\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n            const element = getElementAtPosition(elements, x, y);\n            if (!element) {\n              ContextMenu.push({\n                options: [\n                  navigator.clipboard && {\n                    label: \"Paste\",\n                    action: () => this.pasteFromClipboard()\n                  },\n                  ...this.actionManager.getContextMenuItems(\n                    elements,\n                    this.state,\n                    this.syncActionResult,\n                    action => this.canvasOnlyActions.includes(action)\n                  )\n                ],\n                top: e.clientY,\n                left: e.clientX\n              });\n              return;\n            }\n\n            if (!element.isSelected) {\n              elements = clearSelection(elements);\n              element.isSelected = true;\n              this.forceUpdate();\n            }\n\n            ContextMenu.push({\n              options: [\n                navigator.clipboard && {\n                  label: \"Copy\",\n                  action: this.copyToClipboard\n                },\n                navigator.clipboard && {\n                  label: \"Paste\",\n                  action: () => this.pasteFromClipboard()\n                },\n                ...this.actionManager.getContextMenuItems(\n                  elements,\n                  this.state,\n                  this.syncActionResult,\n                  action => !this.canvasOnlyActions.includes(action)\n                )\n              ],\n              top: e.clientY,\n              left: e.clientX\n            });\n          }}\n          onMouseDown={e => {\n            if (lastMouseUp !== null) {\n              // Unfortunately, sometimes we don't get a mouseup after a mousedown,\n              // this can happen when a contextual menu or alert is triggered. In order to avoid\n              // being in a weird state, we clean up on the next mousedown\n              lastMouseUp(e);\n            }\n\n            // pan canvas on wheel button drag\n            if (e.button === 1) {\n              let { clientX: lastX, clientY: lastY } = e;\n              const onMouseMove = (e: MouseEvent) => {\n                document.documentElement.style.cursor = `grabbing`;\n                let deltaX = lastX - e.clientX;\n                let deltaY = lastY - e.clientY;\n                lastX = e.clientX;\n                lastY = e.clientY;\n                this.setState(state => ({\n                  scrollX: state.scrollX - deltaX,\n                  scrollY: state.scrollY - deltaY\n                }));\n              };\n              const onMouseUp = (lastMouseUp = (e: MouseEvent) => {\n                lastMouseUp = null;\n                resetCursor();\n                window.removeEventListener(\"mousemove\", onMouseMove);\n                window.removeEventListener(\"mouseup\", onMouseUp);\n              });\n              window.addEventListener(\"mousemove\", onMouseMove, {\n                passive: true\n              });\n              window.addEventListener(\"mouseup\", onMouseUp);\n              return;\n            }\n\n            // only handle left mouse button\n            if (e.button !== 0) return;\n            // fixes mousemove causing selection of UI texts #32\n            e.preventDefault();\n            // Preventing the event above disables default behavior\n            //  of defocusing potentially focused input, which is what we want\n            //  when clicking inside the canvas.\n            if (isInputLike(document.activeElement)) {\n              document.activeElement.blur();\n            }\n\n            // Handle scrollbars dragging\n            const {\n              isOverHorizontalScrollBar,\n              isOverVerticalScrollBar\n            } = isOverScrollBars(\n              elements,\n              e.clientX - CANVAS_WINDOW_OFFSET_LEFT,\n              e.clientY - CANVAS_WINDOW_OFFSET_TOP,\n              canvasWidth,\n              canvasHeight,\n              this.state.scrollX,\n              this.state.scrollY\n            );\n\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n            const element = newElement(\n              this.state.elementType,\n              x,\n              y,\n              this.state.currentItemStrokeColor,\n              this.state.currentItemBackgroundColor,\n              \"hachure\",\n              1,\n              1,\n              100\n            );\n\n            type ResizeTestType = ReturnType<typeof resizeTest>;\n            let resizeHandle: ResizeTestType = false;\n            let isResizingElements = false;\n            let draggingOccured = false;\n            let hitElement: ExcalidrawElement | null = null;\n            let elementIsAddedToSelection = false;\n            if (this.state.elementType === \"selection\") {\n              const resizeElement = getElementWithResizeHandler(\n                elements,\n                { x, y },\n                this.state\n              );\n\n              this.setState({\n                resizingElement: resizeElement ? resizeElement.element : null\n              });\n\n              if (resizeElement) {\n                resizeHandle = resizeElement.resizeHandle;\n                document.documentElement.style.cursor = `${resizeHandle}-resize`;\n                isResizingElements = true;\n              } else {\n                hitElement = getElementAtPosition(elements, x, y);\n                // clear selection if shift is not clicked\n                if (!hitElement?.isSelected && !e.shiftKey) {\n                  elements = clearSelection(elements);\n                }\n\n                // If we click on something\n                if (hitElement) {\n                  // deselect if item is selected\n                  // if shift is not clicked, this will always return true\n                  // otherwise, it will trigger selection based on current\n                  // state of the box\n                  if (!hitElement.isSelected) {\n                    hitElement.isSelected = true;\n                    elementIsAddedToSelection = true;\n                  }\n\n                  // We duplicate the selected element if alt is pressed on Mouse down\n                  if (e.altKey) {\n                    elements = [\n                      ...elements.map(element => ({\n                        ...element,\n                        isSelected: false\n                      })),\n                      ...elements\n                        .filter(element => element.isSelected)\n                        .map(element => {\n                          const newElement = duplicateElement(element);\n                          newElement.isSelected = true;\n                          return newElement;\n                        })\n                    ];\n                  }\n                }\n              }\n            } else {\n              elements = clearSelection(elements);\n            }\n\n            if (isTextElement(element)) {\n              let textX = e.clientX;\n              let textY = e.clientY;\n              if (!e.altKey) {\n                const snappedToCenterPosition = this.getTextWysiwygSnappedToCenterPosition(\n                  x,\n                  y\n                );\n                if (snappedToCenterPosition) {\n                  element.x = snappedToCenterPosition.elementCenterX;\n                  element.y = snappedToCenterPosition.elementCenterY;\n                  textX = snappedToCenterPosition.wysiwygX;\n                  textY = snappedToCenterPosition.wysiwygY;\n                }\n              }\n\n              textWysiwyg({\n                initText: \"\",\n                x: textX,\n                y: textY,\n                strokeColor: this.state.currentItemStrokeColor,\n                font: this.state.currentItemFont,\n                onSubmit: text => {\n                  addTextElement(element, text, this.state.currentItemFont);\n                  elements = [...elements, { ...element, isSelected: true }];\n                  this.setState({\n                    draggingElement: null,\n                    elementType: \"selection\"\n                  });\n                }\n              });\n              this.setState({ elementType: \"selection\" });\n              return;\n            }\n\n            if (this.state.elementType === \"text\") {\n              elements = [...elements, { ...element, isSelected: true }];\n              this.setState({\n                draggingElement: null,\n                elementType: \"selection\"\n              });\n            } else {\n              elements = [...elements, element];\n              this.setState({ draggingElement: element });\n            }\n\n            let lastX = x;\n            let lastY = y;\n\n            if (isOverHorizontalScrollBar || isOverVerticalScrollBar) {\n              lastX = e.clientX - CANVAS_WINDOW_OFFSET_LEFT;\n              lastY = e.clientY - CANVAS_WINDOW_OFFSET_TOP;\n            }\n\n            const onMouseMove = (e: MouseEvent) => {\n              const target = e.target;\n              if (!(target instanceof HTMLElement)) {\n                return;\n              }\n\n              if (isOverHorizontalScrollBar) {\n                const x = e.clientX - CANVAS_WINDOW_OFFSET_LEFT;\n                const dx = x - lastX;\n                this.setState(state => ({ scrollX: state.scrollX - dx }));\n                lastX = x;\n                return;\n              }\n\n              if (isOverVerticalScrollBar) {\n                const y = e.clientY - CANVAS_WINDOW_OFFSET_TOP;\n                const dy = y - lastY;\n                this.setState(state => ({ scrollY: state.scrollY - dy }));\n                lastY = y;\n                return;\n              }\n\n              if (isResizingElements && this.state.resizingElement) {\n                const el = this.state.resizingElement;\n                const selectedElements = elements.filter(el => el.isSelected);\n                if (selectedElements.length === 1) {\n                  const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n                  let deltaX = 0;\n                  let deltaY = 0;\n                  selectedElements.forEach(element => {\n                    switch (resizeHandle) {\n                      case \"nw\":\n                        deltaX = lastX - x;\n                        element.width += deltaX;\n                        element.x -= deltaX;\n                        if (e.shiftKey) {\n                          element.y += element.height - element.width;\n                          element.height = element.width;\n                        } else {\n                          const deltaY = lastY - y;\n                          element.height += deltaY;\n                          element.y -= deltaY;\n                        }\n                        break;\n                      case \"ne\":\n                        element.width += x - lastX;\n                        if (e.shiftKey) {\n                          element.y += element.height - element.width;\n                          element.height = element.width;\n                        } else {\n                          deltaY = lastY - y;\n                          element.height += deltaY;\n                          element.y -= deltaY;\n                        }\n                        break;\n                      case \"sw\":\n                        deltaX = lastX - x;\n                        element.width += deltaX;\n                        element.x -= deltaX;\n                        if (e.shiftKey) {\n                          element.height = element.width;\n                        } else {\n                          element.height += y - lastY;\n                        }\n                        break;\n                      case \"se\":\n                        element.width += x - lastX;\n                        if (e.shiftKey) {\n                          element.height = element.width;\n                        } else {\n                          element.height += y - lastY;\n                        }\n                        break;\n                      case \"n\":\n                        deltaY = lastY - y;\n                        element.height += deltaY;\n                        element.y -= deltaY;\n                        break;\n                      case \"w\":\n                        deltaX = lastX - x;\n                        element.width += deltaX;\n                        element.x -= deltaX;\n                        break;\n                      case \"s\":\n                        element.height += y - lastY;\n                        break;\n                      case \"e\":\n                        element.width += x - lastX;\n                        break;\n                    }\n\n                    el.x = element.x;\n                    el.y = element.y;\n                    el.shape = null;\n                  });\n                  lastX = x;\n                  lastY = y;\n                  // We don't want to save history when resizing an element\n                  history.skipRecording();\n                  this.forceUpdate();\n                  return;\n                }\n              }\n\n              if (hitElement?.isSelected) {\n                // Marking that click was used for dragging to check\n                // if elements should be deselected on mouseup\n                draggingOccured = true;\n                const selectedElements = elements.filter(el => el.isSelected);\n                if (selectedElements.length) {\n                  const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n                  selectedElements.forEach(element => {\n                    element.x += x - lastX;\n                    element.y += y - lastY;\n                  });\n                  lastX = x;\n                  lastY = y;\n                  // We don't want to save history when dragging an element to initially size it\n                  history.skipRecording();\n                  this.forceUpdate();\n                  return;\n                }\n              }\n\n              // It is very important to read this.state within each move event,\n              // otherwise we would read a stale one!\n              const draggingElement = this.state.draggingElement;\n              if (!draggingElement) return;\n\n              let width =\n                e.clientX -\n                CANVAS_WINDOW_OFFSET_LEFT -\n                draggingElement.x -\n                this.state.scrollX;\n              let height =\n                e.clientY -\n                CANVAS_WINDOW_OFFSET_TOP -\n                draggingElement.y -\n                this.state.scrollY;\n              draggingElement.width = width;\n              // Make a perfect square or circle when shift is enabled\n              draggingElement.height =\n                e.shiftKey && this.state.elementType !== \"selection\"\n                  ? Math.abs(width) * Math.sign(height)\n                  : height;\n              draggingElement.shape = null;\n\n              if (this.state.elementType === \"selection\") {\n                if (!e.shiftKey) {\n                  elements = clearSelection(elements);\n                }\n                const elementsWithinSelection = getElementsWithinSelection(\n                  elements,\n                  draggingElement\n                );\n                elementsWithinSelection.forEach(element => {\n                  element.isSelected = true;\n                });\n              }\n              // We don't want to save history when moving an element\n              history.skipRecording();\n              this.forceUpdate();\n            };\n\n            const onMouseUp = (e: MouseEvent) => {\n              const { draggingElement, elementType } = this.state;\n\n              lastMouseUp = null;\n              window.removeEventListener(\"mousemove\", onMouseMove);\n              window.removeEventListener(\"mouseup\", onMouseUp);\n\n              resetCursor();\n\n              // If click occured on already selected element\n              // it is needed to remove selection from other elements\n              // or if SHIFT or META key pressed remove selection\n              // from hitted element\n              //\n              // If click occured and elements were dragged or some element\n              // was added to selection (on mousedown phase) we need to keep\n              // selection unchanged\n              if (\n                hitElement &&\n                !draggingOccured &&\n                !elementIsAddedToSelection\n              ) {\n                if (e.shiftKey) {\n                  hitElement.isSelected = false;\n                } else {\n                  elements = clearSelection(elements);\n                  hitElement.isSelected = true;\n                }\n              }\n\n              if (draggingElement === null) {\n                // if no element is clicked, clear the selection and redraw\n                elements = clearSelection(elements);\n                this.forceUpdate();\n                return;\n              }\n\n              if (elementType === \"selection\") {\n                elements = elements.slice(0, -1);\n              } else {\n                draggingElement.isSelected = true;\n              }\n\n              this.setState({\n                draggingElement: null,\n                elementType: \"selection\"\n              });\n\n              history.resumeRecording();\n              this.forceUpdate();\n            };\n\n            lastMouseUp = onMouseUp;\n\n            window.addEventListener(\"mousemove\", onMouseMove);\n            window.addEventListener(\"mouseup\", onMouseUp);\n\n            // We don't want to save history on mouseDown, only on mouseUp when it's fully configured\n            history.skipRecording();\n            this.forceUpdate();\n          }}\n          onDoubleClick={e => {\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n\n            const elementAtPosition = getElementAtPosition(elements, x, y);\n\n            const element = newElement(\n              \"text\",\n              x,\n              y,\n              this.state.currentItemStrokeColor,\n              this.state.currentItemBackgroundColor,\n              \"hachure\",\n              1,\n              1,\n              100\n            ) as ExcalidrawTextElement;\n\n            let initText = \"\";\n            let textX = e.clientX;\n            let textY = e.clientY;\n\n            if (elementAtPosition && isTextElement(elementAtPosition)) {\n              elements = elements.filter(\n                element => element.id !== elementAtPosition.id\n              );\n              this.forceUpdate();\n\n              Object.assign(element, elementAtPosition);\n              // x and y will change after calling addTextElement function\n              element.x = elementAtPosition.x + elementAtPosition.width / 2;\n              element.y = elementAtPosition.y + elementAtPosition.height / 2;\n              initText = elementAtPosition.text;\n              textX =\n                this.state.scrollX +\n                elementAtPosition.x +\n                CANVAS_WINDOW_OFFSET_LEFT +\n                elementAtPosition.width / 2;\n              textY =\n                this.state.scrollY +\n                elementAtPosition.y +\n                CANVAS_WINDOW_OFFSET_TOP +\n                elementAtPosition.height / 2;\n            } else if (!e.altKey) {\n              const snappedToCenterPosition = this.getTextWysiwygSnappedToCenterPosition(\n                x,\n                y\n              );\n\n              if (snappedToCenterPosition) {\n                element.x = snappedToCenterPosition.elementCenterX;\n                element.y = snappedToCenterPosition.elementCenterY;\n                textX = snappedToCenterPosition.wysiwygX;\n                textY = snappedToCenterPosition.wysiwygY;\n              }\n            }\n\n            textWysiwyg({\n              initText,\n              x: textX,\n              y: textY,\n              strokeColor: element.strokeColor,\n              font: element.font || this.state.currentItemFont,\n              onSubmit: text => {\n                addTextElement(\n                  element,\n                  text,\n                  element.font || this.state.currentItemFont\n                );\n                elements = [...elements, { ...element, isSelected: true }];\n                this.setState({\n                  draggingElement: null,\n                  elementType: \"selection\"\n                });\n              }\n            });\n          }}\n          onMouseMove={e => {\n            const hasDeselectedButton = Boolean(e.buttons);\n            if (hasDeselectedButton || this.state.elementType !== \"selection\") {\n              return;\n            }\n            const { x, y } = viewportCoordsToSceneCoords(e, this.state);\n            const selectedElements = elements.filter(e => e.isSelected).length;\n            if (selectedElements === 1) {\n              const resizeElement = getElementWithResizeHandler(\n                elements,\n                { x, y },\n                this.state\n              );\n              if (resizeElement && resizeElement.resizeHandle) {\n                document.documentElement.style.cursor = `${resizeElement.resizeHandle}-resize`;\n                return;\n              }\n            }\n            const hitElement = getElementAtPosition(elements, x, y);\n            document.documentElement.style.cursor = hitElement ? \"move\" : \"\";\n          }}\n        />\n      </div>\n    );\n  }\n\n  private handleWheel = (e: WheelEvent) => {\n    e.preventDefault();\n    const { deltaX, deltaY } = e;\n    this.setState(state => ({\n      scrollX: state.scrollX - deltaX,\n      scrollY: state.scrollY - deltaY\n    }));\n  };\n\n  private addElementsFromPaste = (paste: string) => {\n    let parsedElements;\n    try {\n      parsedElements = JSON.parse(paste);\n    } catch (e) {}\n    if (\n      Array.isArray(parsedElements) &&\n      parsedElements.length > 0 &&\n      parsedElements[0].type // need to implement a better check here...\n    ) {\n      elements = clearSelection(elements);\n\n      let subCanvasX1 = Infinity;\n      let subCanvasX2 = 0;\n      let subCanvasY1 = Infinity;\n      let subCanvasY2 = 0;\n\n      const minX = Math.min(...parsedElements.map(element => element.x));\n      const minY = Math.min(...parsedElements.map(element => element.y));\n\n      const distance = (x: number, y: number) => {\n        return Math.abs(x > y ? x - y : y - x);\n      };\n\n      parsedElements.forEach(parsedElement => {\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(parsedElement);\n        subCanvasX1 = Math.min(subCanvasX1, x1);\n        subCanvasY1 = Math.min(subCanvasY1, y1);\n        subCanvasX2 = Math.max(subCanvasX2, x2);\n        subCanvasY2 = Math.max(subCanvasY2, y2);\n      });\n\n      const elementsCenterX = distance(subCanvasX1, subCanvasX2) / 2;\n      const elementsCenterY = distance(subCanvasY1, subCanvasY2) / 2;\n\n      const dx =\n        this.state.cursorX -\n        this.state.scrollX -\n        CANVAS_WINDOW_OFFSET_LEFT -\n        elementsCenterX;\n      const dy =\n        this.state.cursorY -\n        this.state.scrollY -\n        CANVAS_WINDOW_OFFSET_TOP -\n        elementsCenterY;\n\n      elements = [\n        ...elements,\n        ...parsedElements.map(parsedElement => {\n          const duplicate = duplicateElement(parsedElement);\n          duplicate.x += dx - minX;\n          duplicate.y += dy - minY;\n          return duplicate;\n        })\n      ];\n      this.forceUpdate();\n    }\n  };\n\n  private getTextWysiwygSnappedToCenterPosition(x: number, y: number) {\n    const elementClickedInside = getElementContainingPosition(elements, x, y);\n    if (elementClickedInside) {\n      const elementCenterX =\n        elementClickedInside.x + elementClickedInside.width / 2;\n      const elementCenterY =\n        elementClickedInside.y + elementClickedInside.height / 2;\n      const distanceToCenter = Math.hypot(\n        x - elementCenterX,\n        y - elementCenterY\n      );\n      const isSnappedToCenter =\n        distanceToCenter < TEXT_TO_CENTER_SNAP_THRESHOLD;\n      if (isSnappedToCenter) {\n        const wysiwygX =\n          this.state.scrollX +\n          elementClickedInside.x +\n          CANVAS_WINDOW_OFFSET_LEFT +\n          elementClickedInside.width / 2;\n        const wysiwygY =\n          this.state.scrollY +\n          elementClickedInside.y +\n          CANVAS_WINDOW_OFFSET_TOP +\n          elementClickedInside.height / 2;\n        return { wysiwygX, wysiwygY, elementCenterX, elementCenterY };\n      }\n    }\n  }\n\n  private saveDebounced = debounce(() => {\n    saveToLocalStorage(elements, this.state);\n  }, 300);\n\n  componentDidUpdate() {\n    renderScene(elements, this.rc!, this.canvas!, {\n      scrollX: this.state.scrollX,\n      scrollY: this.state.scrollY,\n      viewBackgroundColor: this.state.viewBackgroundColor\n    });\n    this.saveDebounced();\n    if (history.isRecording()) {\n      history.pushEntry(history.generateCurrentEntry(elements));\n    }\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n"],"sourceRoot":""}